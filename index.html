<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operalta — Platform Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        :root {
            --grid-color: #f0f0f0;
            --accent: #5B21B6;
            --color-recording: #ff3b30;
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(0, 0, 0, 0.07);
            --glass-shadow: rgba(0, 0, 0, 0.05);
            --glass-recording-bg: rgba(248, 248, 248, 0.75);
            --glass-recording-border: rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Space Grotesk', -apple-system, sans-serif;
            background-color: #f9fafb;
        }
        
        .mono {
            font-family: 'Space Mono', monospace;
        }

        .baseline-grid {
            background-image: linear-gradient(var(--grid-color) 1px, transparent 1px);
            background-size: 100% 16px;
        }
        
        .sidebar-link { transition: all 0.2s ease; }
        .sidebar-link:hover, .sidebar-link.active { background-color: #f3f4f6; color: #111827; }
        .sidebar-link.active { font-weight: 600; }
        #sidebar { transition: transform 0.3s ease-in-out; }

        /* CEO/VC Toggle Switch */
        .toggle-dot { transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        input:checked ~ .toggle-bg { background-color: var(--accent); }
        input:checked ~ .toggle-dot { transform: translateX(100%); }

        /* Dictation App Styles Integration */
        .recording-interface {
            transition: all 0.45s ease-in-out;
            z-index: 10;
        }
        .recording-interface.is-live {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: 350px;
            z-index: 1000;
            background-color: var(--glass-recording-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-recording-border);
            box-shadow: 0 -4px 20px var(--glass-shadow);
            justify-content: flex-start;
            padding: 20px;
        }
        .live-recording-title, #liveWaveformCanvas, .live-recording-timer {
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.3s ease-out 0.1s, transform 0.35s ease-out 0.1s;
        }
        .recording-interface.is-live .live-recording-title,
        .recording-interface.is-live #liveWaveformCanvas,
        .recording-interface.is-live .live-recording-timer {
            opacity: 1;
            transform: translateY(0);
        }
        #liveWaveformCanvas { width: 100%; max-width: 340px; height: 70px; margin-bottom: 18px; border-radius: 4px; }
        .live-recording-timer { font-family: var(--font-mono); font-size: 44px; font-weight: 400; margin-bottom: 22px; text-align: center; }
        
        .record-button { position: relative; width: 72px; height: 72px; border-radius: 50%; border: none; outline: none; background: none; cursor: pointer; z-index: 1; }
        .record-button-inner { position: relative; width: 100%; height: 100%; border-radius: 50%; background: var(--glass-bg); border: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: center; color: #111827; font-size: 24px; z-index: 2; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }
        .record-button:hover .record-button-inner { transform: scale(1.08); }
        .record-button.recording .record-button-inner { background-color: var(--color-recording); border-color: transparent; color: white; }

        @keyframes wave { 0% { transform: scale(0.4); opacity: 0.8; } 100% { transform: scale(1.8); opacity: 0; } }
        .record-waves { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; z-index: 1; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .record-button.recording .record-waves { opacity: 1; }
        .wave { fill: none; stroke: var(--color-recording); stroke-width: 1.5px; opacity: 0; transform-origin: center; }
        .record-button.recording .wave1 { animation: wave 2s infinite ease-out; }
        .record-button.recording .wave2 { animation: wave 2s infinite ease-out 0.4s; }
        
        .notion-block {
            border-left: 3px solid var(--accent);
            padding-left: 1rem;
            margin-top: 0.5rem;
        }
        
        /* Modal Styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        /* Playbook Category Filter */
        .playbook-category-btn { transition: all 0.2s ease; border: 1px solid #e5e7eb; }
        .playbook-category-btn.active, .playbook-category-btn:hover {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
        }
    </style>
     <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^0.8.0",
          "marked": "https://esm.sh/marked@^4.0.0"
        }
      }
    </script>
</head>
<body class="text-gray-900 overflow-x-hidden">

    <div class="relative min-h-screen md:flex">
        <!-- Mobile Header -->
        <div class="md:hidden flex justify-between items-center bg-white border-b border-gray-200 p-4 sticky top-0 z-40">
            <a href="#" class="font-bold text-sm tracking-wider">Operalta</a>
            <button id="mobile-menu-btn">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>

        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="w-64 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col fixed inset-y-0 left-0 z-50 transform -translate-x-full md:relative md:translate-x-0">
            <div class="h-16 flex items-center px-6 border-b border-gray-200">
                <a href="#" class="font-bold text-sm tracking-wider flex items-center gap-2"><span>Operalta</span></a>
            </div>
            
            <nav id="ceo-nav" class="flex-1 px-4 py-6 space-y-2">
                <a href="#" id="nav-dashboard" class="sidebar-link active flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>Dashboard</a>
                <a href="#" id="nav-reports" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>Reports</a>
                <a href="#" id="nav-playbooks" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18"></path></svg>Playbooks</a>
                <a href="#" id="nav-integrations" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>Integrations</a>
                <a href="#" id="nav-settings" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>Settings</a>
            </nav>
            <nav id="vc-nav" class="hidden flex-1 px-4 py-6 space-y-2">
                <a href="#" id="nav-vc-dashboard" class="sidebar-link active flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2a4 4 0 00-4-4H3s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1h-2a4 4 0 00-4 4v2"></path><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"></path><path d="M17.63 17.63A4 4 0 1014 14a4 4 0 003.63 3.63z"></path></svg>Portfolio</a>
                <a href="#" id="nav-vc-playbooks" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18"></path></svg>Playbooks</a>
                 <a href="#" id="nav-vc-settings" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>Settings</a>
            </nav>
            
             <div class="px-4 py-4 mt-auto border-t border-gray-200">
                <div class="flex items-center mb-4">
                    <img id="user-avatar" class="h-8 w-8 rounded-full object-cover" src="https://placehold.co/100x100/5B21B6/FFFFFF?text=A" alt="User Avatar">
                    <div class="ml-3">
                        <p id="user-name" class="text-sm font-semibold text-gray-800">Alex (CEO)</p>
                        <p id="user-company" class="text-xs text-gray-500">Acme Inc.</p>
                    </div>
                </div>
                 <div class="mt-4 text-xs mono">
                    <label for="view-toggle" class="flex items-center cursor-pointer">
                        <span id="ceo-label" class="mr-2 font-semibold text-purple-700">CEO</span>
                        <div class="relative">
                            <input type="checkbox" id="view-toggle" class="sr-only">
                            <div class="toggle-bg block bg-gray-200 w-10 h-5 rounded-full"></div>
                            <div class="toggle-dot absolute left-0 top-0 bg-white w-5 h-5 rounded-full shadow-md"></div>
                        </div>
                        <span id="vc-label" class="ml-2 text-gray-500">VC</span>
                    </label>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1">
            <div id="ceo-view">
                <div id="page-dashboard" class="p-4 sm:p-8 md:p-12 baseline-grid">
                    <div id="api-key-banner" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded-r-lg" role="alert">
                        <p class="font-bold">Action Required</p>
                        <p>Please <a href="#" id="banner-settings-link" class="underline font-semibold">add your Gemini API key</a> in the settings to enable recording.</p>
                    </div>
                    <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">CEO Dashboard</h1><p class="text-gray-500 mt-1 mono text-sm">Welcome back, Alex. Your augmented co-founder is ready.</p></header><div class="bg-white p-6 sm:p-8 border border-gray-200 rounded-lg shadow-sm mb-8"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4"><h2 class="text-lg font-bold">Create Weekly Update</h2><span class="text-xs mono text-gray-500 mt-1 sm:mt-0">Voice Memo → AI Synthesis → Investor Report</span></div><div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6"><button id="start-recording-btn" class="w-16 h-16 bg-purple-700 text-white rounded-full flex items-center justify-center hover:bg-purple-800 transition-all transform hover:scale-105 shadow-lg flex-shrink-0"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg></button><div class="flex-1"><p class="font-semibold">Record a 5-minute voice memo</p><p class="text-sm text-gray-600">Summarize your week: wins, challenges, and key metrics. Our AI will do the rest.</p></div></div></div>
                     <div class="bg-white p-6 sm:p-8 border border-gray-200 rounded-lg shadow-sm">
                        <h2 class="text-lg font-bold mb-4">Recent Activity</h2>
                        <div class="text-sm text-gray-500">No recent reports. Record an update to get started.</div>
                    </div>
                </div>
                
                <div id="page-recording" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">New Weekly Update</h1></header>
                    <div id="processing-state" class="hidden text-center py-16"><div class="inline-block w-8 h-8 border-2 border-purple-700 border-t-transparent rounded-full animate-spin mb-4"></div><h3 id="processing-status" class="font-bold">Processing audio...</h3><p class="text-sm text-gray-600 mt-2">This usually takes less than a minute.</p></div>
                    <div id="completed-state" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-12">
                        <!-- AI Analysis -->
                        <div id="extracted-intelligence">
                             <h4 class="font-bold text-sm mb-4">Extracted Intelligence</h4>
                             <div class="bg-white p-6 border border-gray-200 rounded-lg space-y-4">
                                <!-- Content injected here -->
                             </div>
                        </div>
                        <!-- Strategic Update -->
                        <div id="strategic-update">
                            <h4 class="font-bold text-sm mb-4">Strategic Update</h4>
                            <div class="bg-white border-2 border-gray-200 p-6 rounded-lg shadow-lg">
                                <!-- Content injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="page-reports" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8 flex justify-between items-center">
                        <div>
                            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Reports</h1>
                            <p class="text-gray-500 mt-1 mono text-sm">History of all generated investor updates.</p>
                        </div>
                        <button id="new-report-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">New Report</button>
                    </header>
                    <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50"><tr class="text-left text-xs text-gray-500 uppercase tracking-wider"><th class="p-4 font-semibold">Date</th><th class="p-4 font-semibold">Title</th><th class="p-4 font-semibold">Status</th><th class="p-4 font-semibold hidden md:table-cell">Key Metric</th><th class="p-4"></th></tr></thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr><td class="p-4">Sep 5, 2025</td><td class="p-4 font-semibold">Weekly Update - W36</td><td class="p-4"><span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full">Sent</span></td><td class="p-4 hidden md:table-cell">23% MoM Growth</td><td class="p-4 text-right"><a href="#" class="text-purple-700 hover:underline view-report-link" data-report-id="w36">View</a></td></tr>
                                <tr><td class="p-4">Aug 29, 2025</td><td class="p-4 font-semibold">Weekly Update - W35</td><td class="p-4"><span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full">Sent</span></td><td class="p-4 hidden md:table-cell">Onboarded 2 Enterprise clients</td><td class="p-4 text-right"><a href="#" class="text-purple-700 hover:underline view-report-link" data-report-id="w35">View</a></td></tr>
                                 <tr><td class="p-4">Aug 22, 2025</td><td class="p-4 font-semibold">Weekly Update - W34</td><td class="p-4"><span class="px-2 py-1 text-xs font-semibold text-yellow-800 bg-yellow-100 rounded-full">Draft</span></td><td class="p-4 hidden md:table-cell">Hiring top priority</td><td class="p-4 text-right"><a href="#" class="text-purple-700 hover:underline view-report-link" data-report-id="w34">View</a></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="page-playbooks" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8 flex justify-between items-baseline">
                         <div>
                            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Playbook Library</h1>
                            <p class="text-gray-500 mt-1 mono text-sm">1,247+ proven strategies from top-tier companies.</p>
                        </div>
                    </header>
                    <div id="playbook-category-filters" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 text-center mb-12">
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Growth"><span class="text-2xl mb-1">⬆</span><span class="text-xs font-bold">GROWTH</span></div>
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Hiring"><span class="text-2xl mb-1">◐</span><span class="text-xs font-bold">HIRING</span></div>
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Fundraising"><span class="text-2xl mb-1">◈</span><span class="text-xs font-bold">FUNDRAISING</span></div>
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Product"><span class="text-2xl mb-1">◉</span><span class="text-xs font-bold">PRODUCT</span></div>
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Sales"><span class="text-2xl mb-1">▣</span><span class="text-xs font-bold">SALES</span></div>
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Legal"><span class="text-2xl mb-1">◊</span><span class="text-xs font-bold">LEGAL</span></div>
                    </div>
                     <div id="ceo-playbook-list" class="space-y-8">
                        <!-- Playbook content will be injected here by JS -->
                    </div>
                </div>

                <div id="page-integrations" class="hidden p-4 sm:p-8 md:p-12">
                     <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Integrations</h1><p class="text-gray-500 mt-1 mono text-sm">Connect Operalta to your existing workflow.</p></header>
                     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://placehold.co/40x40/000000/FFFFFF?text=N" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">Notion</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Sync your company wiki, roadmaps, and KPIs to provide context for AI analysis.</p><button class="w-full bg-green-500 text-white py-2 text-sm font-bold rounded-md">Connected</button></div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://placehold.co/40x40/4A154B/FFFFFF?text=S" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">Slack</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Send report summaries and get notifications directly in your team's channels.</p><button class="w-full bg-gray-200 text-gray-800 py-2 text-sm font-bold hover:bg-gray-300 rounded-md">Connect</button></div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://placehold.co/40x40/635BFF/FFFFFF?text=S" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">Stripe</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Automatically pull in key financial metrics like ARR, MRR, and growth rates.</p><button class="w-full bg-gray-200 text-gray-800 py-2 text-sm font-bold hover:bg-gray-300 rounded-md">Connect</button></div>
                     </div>
                </div>
                
                <div id="page-settings" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Settings</h1></header>
                    <div class="bg-white p-6 sm:p-8 border border-gray-200 rounded-lg shadow-sm max-w-2xl">
                        <h2 class="text-lg font-bold mb-1">API Configuration</h2>
                        <p class="text-sm text-gray-600 mb-4">A valid Google Gemini API key is required for audio transcription and analysis.</p>
                        <div class="space-y-2">
                            <label for="api-key-input" class="text-sm font-semibold text-gray-700">Gemini API Key</label>
                            <input type="password" id="api-key-input" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" placeholder="Enter your API key">
                        </div>
                        <div class="mt-4 flex items-center justify-between">
                            <button id="save-api-key-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">Save Key</button>
                            <span id="api-key-status" class="text-sm text-green-600"></span>
                        </div>
                        <p class="text-xs text-gray-500 mt-4">You can get a key from <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-purple-700 underline">Google AI Studio</a>. Your key is stored in your browser's local storage.</p>
                        <div class="mt-4 bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-3 text-xs" role="alert">
                            <p><strong class="font-bold">Security Notice:</strong> For this prototype, your API key is stored in local storage. For production applications, always use a secure vault or environment variables to protect your credentials.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="vc-view" class="hidden">
                 <div id="page-vc-dashboard" class="p-4 sm:p-8 md:p-12">
                    <header class="mb-8">
                        <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Portfolio Dashboard</h1>
                        <p class="text-gray-500 mt-1 mono text-sm">High-level intelligence on your investments.</p>
                    </header>

                    <div class="mb-8 bg-white border border-gray-200 rounded-lg p-6">
                        <h2 class="font-bold mb-4">Portfolio Health Overview</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                            <div><p class="text-3xl font-bold text-green-600">8</p><p class="text-sm text-gray-500">On Track</p></div>
                            <div><p class="text-3xl font-bold text-yellow-500">2</p><p class="text-sm text-gray-500">Needs Attention</p></div>
                            <div><p class="text-3xl font-bold text-red-600">0</p><p class="text-sm text-gray-500">At Risk</p></div>
                        </div>
                    </div>
                    
                    <div class="mb-8 bg-white border border-gray-200 rounded-lg p-6">
                        <h2 class="font-bold mb-4">AI-Generated Cross-Portfolio Insights</h2>
                        <ul class="space-y-3 text-sm">
                            <li class="flex items-start gap-3"><span class="text-purple-600 mt-1">◈</span><span><strong>Positive Trend:</strong> 5 companies mentioned successful enterprise pilots this week, suggesting strong Q4 pipeline.</span></li>
                            <li class="flex items-start gap-3"><span class="text-yellow-600 mt-1">!</span><span><strong>Potential Risk:</strong> 3 companies in the B2C space noted rising customer acquisition costs (CAC). <a href="#" class="text-purple-700 underline">Suggest "Growth Hacking" playbook</a>.</span></li>
                            <li class="flex items-start gap-3"><span class="text-blue-600 mt-1">→</span><span><strong>Opportunity:</strong> Innovate Inc. and Synergy AI are both hiring for senior product roles. Consider an introduction between their VPs of Product to share best practices.</span></li>
                        </ul>
                    </div>

                    <div id="vc-portfolio-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Portfolio companies injected by JS -->
                    </div>
                </div>
                 <div id="page-vc-playbooks" class="hidden p-4 sm:p-8 md:p-12">
                     <header class="mb-8 flex justify-between items-baseline">
                         <div>
                            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Firm Playbooks</h1>
                            <p class="text-gray-500 mt-1 mono text-sm">Proprietary strategies for your portfolio companies.</p>
                        </div>
                        <button id="author-playbook-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">Author New Playbook</button>
                    </header>
                    <div class="mb-8">
                        <h2 class="font-bold mb-4">Atomic Ventures' Custom Playbooks</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="board-meetings"><h3 class="font-bold mb-2">Our Guide to Board Meetings</h3><p class="text-sm text-gray-600">The essential template and best practices for running an effective board meeting.</p></div>
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="term-sheet"><h3 class="font-bold mb-2">Term Sheet Negotiation 101</h3><p class="text-sm text-gray-600">Key terms and strategies for a successful fundraise.</p></div>
                        </div>
                    </div>
                     <div>
                        <h2 class="font-bold mb-4">Playbooks Popular in Your Portfolio</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="eng-hiring"><h3 class="font-bold mb-2">Scaling Engineering Teams</h3><p class="text-sm text-gray-600">From 10 to 100 engineers. The definitive guide by Revolut.</p></div>
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="seed-deck"><h3 class="font-bold mb-2">The Perfect Seed Deck</h3><p class="text-sm text-gray-600">As recommended by Y Combinator for all their early-stage founders.</p></div>
                        </div>
                    </div>
                 </div>
                 <div id="page-vc-settings" class="hidden p-4 sm:p-8 md:p-12">
                      <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Settings</h1></header>
                      <p>VC settings page placeholder.</p>
                 </div>
            </div>
        </main>
        
        <div id="recording-interface" class="recording-interface hidden flex-col items-center">
            <div id="liveRecordingTitle" class="live-recording-title hidden text-lg font-semibold">New Recording</div>
            <canvas id="liveWaveformCanvas" class="hidden"></canvas>
            <div id="liveRecordingTimerDisplay" class="live-recording-timer hidden">00:00.00</div>
            <div id="recording-status-text" class="status-text text-gray-500 mb-4">Ready to record</div>
            <div class="recording-controls">
                <button id="recordButton" class="record-button" title="Start Recording"><div class="record-button-inner"><i class="fas fa-microphone"></i></div><svg class="record-waves" viewBox="0 0 200 200"><circle class="wave wave1" cx="100" cy="100" r="40" /><circle class="wave wave2" cx="100" cy="100" r="70" /></svg></button>
            </div>
        </div>

        <!-- Generic Modal -->
        <div id="modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div id="modal-overlay" class="absolute inset-0"></div>
            <div id="modal-content" class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto relative transform scale-95 opacity-0">
                <div class="p-6">
                    <div class="flex justify-between items-center pb-4 border-b border-gray-200">
                        <h2 id="modal-title" class="text-xl font-bold">Modal Title</h2>
                        <button id="modal-close-btn" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
                    </div>
                    <div id="modal-body" class="py-6">
                        <!-- Modal content goes here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI } from "@google/genai";
        import { marked } from "marked";

        const MODEL_NAME = 'gemini-1.5-flash';

        class DictationService {
            constructor(options) {
                this.genAI = null;
                this.apiKey = options.apiKey;

                if (this.apiKey) {
                    try {
                        this.genAI = new GoogleGenAI({ apiKey: this.apiKey });
                    } catch (e) {
                        console.error("Failed to initialize GoogleGenAI:", e);
                    }
                }

                // Cache all UI elements from options
                this.recordButton = options.recordButton;
                this.statusTextElement = options.statusTextElement;
                this.liveWaveformCanvas = options.liveWaveformCanvas;
                this.liveRecordingTimerDisplay = options.liveRecordingTimerDisplay;
                this.recordingInterface = options.recordingInterface;
                this.liveRecordingTitle = options.liveRecordingTitle;

                this.onProcessingComplete = options.onProcessingComplete;
                this.onRecordingStart = options.onRecordingStart;
                this.onRecordingStop = options.onRecordingStop;

                if (this.liveWaveformCanvas) {
                    this.liveWaveformCtx = this.liveWaveformCanvas.getContext('2d');
                }
                
                this.audioChunks = [];
                this.isRecording = false;
                this.mediaRecorder = null;
                this.stream = null;
                this.audioContext = null;

                this.bindEventListeners();
            }
            
            isReady() {
                return this.genAI !== null;
            }

            bindEventListeners() {
                this.recordButton.addEventListener('click', () => this.toggleRecording());
                window.addEventListener('resize', () => this.handleResize());
            }
            
            handleResize() { if (this.isRecording) requestAnimationFrame(() => this.setupCanvasDimensions()); }

            setupCanvasDimensions() {
                if (!this.liveWaveformCanvas || !this.liveWaveformCtx) return;
                const canvas = this.liveWaveformCanvas;
                const dpr = window.devicePixelRatio || 1;
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                this.liveWaveformCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
            }

            async toggleRecording() {
                if (!this.isReady()) {
                    console.error("Dictation service not ready. API Key might be missing or invalid.");
                    this.statusTextElement.textContent = 'API Key invalid.';
                    this.statusTextElement.style.color = 'red';
                    return;
                }
                this.isRecording ? await this.stopRecording() : await this.startRecording();
            }
            
            async startRecording() {
                try {
                    this.audioChunks = [];
                    this.statusTextElement.textContent = 'Requesting microphone...';
                    this.stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    this.mediaRecorder = new MediaRecorder(this.stream);
                    this.mediaRecorder.ondataavailable = e => { if (e.data.size > 0) this.audioChunks.push(e.data) };
                    this.mediaRecorder.onstop = () => {
                        if (this.onRecordingStop) this.onRecordingStop();
                        this.stopLiveDisplay();
                        if (this.audioChunks.length > 0) {
                            const audioBlob = new Blob(this.audioChunks, { type: this.mediaRecorder?.mimeType || 'audio/webm' });
                            this.processAudio(audioBlob);
                        }
                        if (this.stream) this.stream.getTracks().forEach(track => track.stop());
                    };

                    this.mediaRecorder.start();
                    this.isRecording = true;
                    this.recordButton.classList.add('recording');
                    this.recordButton.title = 'Stop Recording';
                    this.startLiveDisplay();
                    if(this.onRecordingStart) this.onRecordingStart();

                } catch (error) {
                    console.error("Error starting recording:", error);
                    this.statusTextElement.textContent = 'Microphone access denied.';
                }
            }
            
            async stopRecording() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    this.recordButton.classList.remove('recording');
                    this.recordButton.title = 'Start Recording';
                    this.statusTextElement.textContent = 'Processing...';
                }
            }
            
            startLiveDisplay() {
                this.recordingInterface.classList.add('is-live');
                [this.liveRecordingTitle, this.liveWaveformCanvas, this.liveRecordingTimerDisplay].forEach(el => el?.classList.remove('hidden'));
                this.setupCanvasDimensions();
                const icon = this.recordButton.querySelector('i');
                if(icon) { icon.classList.remove('fa-microphone'); icon.classList.add('fa-stop'); }
                this.setupAudioVisualizer();
                this.drawLiveWaveform();
                this.recordingStartTime = Date.now();
                if (this.timerIntervalId) clearInterval(this.timerIntervalId);
                this.timerIntervalId = setInterval(() => this.updateLiveTimer(), 50);
            }

            stopLiveDisplay() {
                 this.recordingInterface.classList.remove('is-live');
                 setTimeout(() => this.recordingInterface.classList.add('hidden'), 500);
                [this.liveRecordingTitle, this.liveWaveformCanvas, this.liveRecordingTimerDisplay].forEach(el => el?.classList.add('hidden'));
                const icon = this.recordButton.querySelector('i');
                if(icon) { icon.classList.remove('fa-stop'); icon.classList.add('fa-microphone'); }
                if (this.waveformDrawingId) cancelAnimationFrame(this.waveformDrawingId);
                if (this.timerIntervalId) clearInterval(this.timerIntervalId);
                if (this.audioContext && this.audioContext.state !== 'closed') this.audioContext.close();
                this.audioContext = null;
            }

            setupAudioVisualizer() {
                if (!this.stream) return;
                this.audioContext = new AudioContext();
                const source = this.audioContext.createMediaStreamSource(this.stream);
                this.analyserNode = this.audioContext.createAnalyser();
                this.analyserNode.fftSize = 256;
                this.waveformDataArray = new Uint8Array(this.analyserNode.frequencyBinCount);
                source.connect(this.analyserNode);
            }

            drawLiveWaveform() {
                if (!this.isRecording) return;
                this.waveformDrawingId = requestAnimationFrame(() => this.drawLiveWaveform());
                if (!this.analyserNode) return;
                this.analyserNode.getByteFrequencyData(this.waveformDataArray);
                const ctx = this.liveWaveformCtx, canvas = this.liveWaveformCanvas;
                if(!ctx || !canvas) return;
                ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);
                const numBars = this.waveformDataArray.length * 0.5;
                const barWidth = canvas.clientWidth / numBars * 0.7;
                let x = 0;
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--color-recording').trim();
                for (let i = 0; i < numBars; i++) {
                    const barHeight = (this.waveformDataArray[i] / 255) * canvas.clientHeight;
                    ctx.fillRect(x, (canvas.clientHeight - barHeight) / 2, barWidth, barHeight);
                    x += barWidth * 1.3;
                }
            }
            
            updateLiveTimer() {
                const elapsedMs = Date.now() - this.recordingStartTime;
                const minutes = Math.floor(elapsedMs / 60000);
                const seconds = Math.floor((elapsedMs % 60000) / 1000);
                const hundredths = Math.floor((elapsedMs % 1000) / 10);
                this.liveRecordingTimerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(hundredths).padStart(2, '0')}`;
            }

            async processAudio(audioBlob) {
                const base64Audio = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result.split(',')[1]);
                    reader.onerror = reject;
                    reader.readAsDataURL(audioBlob);
                });
                const mimeType = this.mediaRecorder?.mimeType || 'audio/webm';
                await this.getTranscription(base64Audio, mimeType);
            }

            async getTranscription(base64Audio, mimeType) {
                try {
                    const contents = [{ text: 'Please provide a verbatim transcript of this audio recording.' }, { inlineData: { mimeType, data: base64Audio } }];
                    const response = await this.genAI.getGenerativeModel({ model: MODEL_NAME }).generateContent({ contents });
                    this.getPolishedNote(response.response.text());
                } catch (error) { 
                    console.error("Error during transcription:", error);
                    this.onProcessingComplete(null, null, { error: `Transcription failed: ${error.message}` }); 
                }
            }

            async getPolishedNote(rawTranscription) {
                 try {
                    if (!rawTranscription.trim()) { 
                        this.onProcessingComplete(null, rawTranscription, { arr: 'N/A', growth: 'N/A', runway: 'N/A' });
                        return;
                    }
                    const prompt = `
                        Analyze the following raw transcript of a CEO's weekly update. Your task is to extract key information and create a polished summary.
                        
                        Respond with ONLY a JSON object in the following format, with no other text or markdown formatting:
                        {
                          "arr": "Extract the current ARR. Format as a string, e.g., '€1.2M'. If not mentioned, return 'N/A'.",
                          "growth": "Extract the month-over-month growth. Format as a string, e.g., '+23%'. If not mentioned, return 'N/A'.",
                          "runway": "Extract the current runway. Format as a string, e.g., '18mo'. If not mentioned, return 'N/A'.",
                          "wins": [ "List key wins as an array of strings." ],
                          "challenges": [ "List key challenges as an array of strings." ],
                          "insights": [ "List key strategic insights or learnings as an array of strings." ],
                          "fullSummary": "Create a polished, professional, and concise investor update in Markdown format based on the transcript. Synthesize the core ideas and structure the output clearly using headings like ### Wins, ### Challenges, and ### Next Steps. Use bullet points for lists of achievements, tasks, or metrics. Remove all filler words and correct grammar."
                        }

                        Here is the raw transcript:
                        ---
                        ${rawTranscription}
                        ---
                    `;
                    const result = await this.genAI.getGenerativeModel({ model: MODEL_NAME }).generateContent(prompt);
                    const jsonMatch = result.response.text().match(/```json\n([\s\S]*?)\n```/);
                    if (!jsonMatch || !jsonMatch[1]) {
                        throw new Error("AI response did not contain valid JSON.");
                    }
                    const jsonText = jsonMatch[1];
                    const data = JSON.parse(jsonText);
                    this.onProcessingComplete(data, rawTranscription, null);
                } catch (error) { 
                    console.error("Error during polishing:", error);
                    this.onProcessingComplete(null, rawTranscription, { error: `AI analysis failed: ${error.message}` });
                }
            }
        }

        var app = {
            dictationService: null,
            currentView: 'ceo',
            latestGeneratedReport: {},

            init() {
                const start = () => {
                    ui.init();
                    this.loadInitialData();
                    this.setupEventListeners();
                };

                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', start);
                } else {
                    start();
                }
            },

            loadInitialData() {
                const savedApiKey = localStorage.getItem('geminiApiKey');
                if (savedApiKey) {
                    ui.elements.apiKeyInput.value = savedApiKey;
                }
                api.initializeDictationService(savedApiKey);
                ui.populateCeoPlaybooks();
                ui.populateVcPortfolio();
            },

            setupEventListeners() {
                ui.elements.viewToggle.addEventListener('change', () => this.switchView());
                Object.entries(ui.elements.navLinks.ceo).forEach(([name, link]) => link?.addEventListener('click', (e) => { e.preventDefault(); ui.showPage(name); }));
                Object.entries(ui.elements.navLinks.vc).forEach(([name, link]) => link?.addEventListener('click', (e) => { e.preventDefault(); ui.showPage(`vc-${name}`); }));
                ui.elements.bannerSettingsLink.addEventListener('click', (e) => { e.preventDefault(); ui.showPage('settings'); });
                ui.elements.mobileMenuBtn.addEventListener('click', () => { ui.elements.sidebar.classList.toggle('-translate-x-full'); });
                ui.elements.startRecordingBtn.addEventListener('click', () => this.dictationService?.toggleRecording());
                if (ui.elements.newReportBtn) ui.elements.newReportBtn.addEventListener('click', () => ui.showPage('dashboard'));
                ui.elements.saveApiKeyBtn.addEventListener('click', () => api.saveApiKey());
                if (ui.elements.authorPlaybookBtn) ui.elements.authorPlaybookBtn.addEventListener('click', ui.showAuthorPlaybookModal);
                ui.elements.modalCloseBtn.addEventListener('click', ui.hideModal);
                ui.elements.modalOverlay.addEventListener('click', ui.hideModal);

                ui.elements.playbookCategoryFilters.addEventListener('click', (e) => {
                    const targetButton = e.target.closest('.playbook-category-btn');
                    if (targetButton) {
                        targetButton.classList.toggle('active');
                        ui.populateCeoPlaybooks();
                    }
                });

                document.addEventListener('click', (e) => this.handleDelegatedClicks(e));
            },

            handleDelegatedClicks(e) {
                const target = e.target;
                const delegatedActions = {
                    '#finalize-report-btn-2': () => ui.showShareModal(),
                    '.view-report-link': (el) => ui.showViewReportModal(el.dataset.reportId),
                    '.playbook-link': (el) => ui.showPlaybookModal(el.dataset.playbookId),
                    '.playbook-view-btn': (el) => ui.showPlaybookModal(el.dataset.playbookId),
                    '#vc-portfolio-list > div[data-company-id]': (el) => ui.showCompanyDetailModal(el.dataset.companyId),
                    '#copy-link-btn': () => {
                        navigator.clipboard.writeText(document.getElementById('share-link-input').value);
                        target.textContent = 'Copied!';
                        setTimeout(() => target.textContent = 'Copy', 2000);
                    },
                    '#send-update-btn': () => {
                        target.textContent = 'Sent!';
                        target.classList.replace('bg-purple-700', 'bg-green-500');
                        setTimeout(ui.hideModal, 1500);
                    },
                    '#save-playbook-btn': () => {
                        target.textContent = 'Saved!';
                        target.classList.replace('bg-purple-700', 'bg-green-500');
                        setTimeout(ui.hideModal, 1500);
                    },
                    '#share-playbook-btn': () => alert('Playbook shared with portfolio!'),
                };

                for (const selector in delegatedActions) {
                    const element = target.closest(selector);
                    if (element) {
                        e.preventDefault();
                        delegatedActions[selector](element);
                        return;
                    }
                }
            },

            switchView() {
                ui.hideModal();
                const isVcView = ui.elements.viewToggle.checked;
                this.currentView = isVcView ? 'vc' : 'ceo';
                
                ui.elements.ceoView.classList.toggle('hidden', isVcView);
                ui.elements.vcView.classList.toggle('hidden', !isVcView);
                ui.elements.ceoNav.classList.toggle('hidden', isVcView);
                ui.elements.vcNav.classList.toggle('hidden', !isVcView);

                if (isVcView) {
                    ui.updateUser('Sarah (Partner)', 'Alpha Ventures', 'https://placehold.co/100x100/8B5CF6/FFFFFF?text=S');
                    ui.toggleLabels(true);
                    ui.showPage('vc-dashboard');
                } else {
                    ui.updateUser('Alex (CEO)', 'Acme Inc.', 'https://placehold.co/100x100/5B21B6/FFFFFF?text=A');
                    ui.toggleLabels(false);
                    ui.showPage('dashboard');
                }
            }
        };

        var api = {
            genAI: null,
            DictationService: DictationService,

            initializeDictationService(apiKey) {
                if (apiKey) {
                    try {
                        this.genAI = new GoogleGenAI({ apiKey });
                        app.dictationService = new this.DictationService({
                            apiKey,
                            genAI: this.genAI,
                            recordButton: ui.elements.recordButton,
                            statusTextElement: ui.elements.statusTextElement,
                            liveWaveformCanvas: ui.elements.liveWaveformCanvas,
                            liveRecordingTimerDisplay: ui.elements.liveRecordingTimerDisplay,
                            recordingInterface: ui.elements.recordingInterface,
                            liveRecordingTitle: ui.elements.liveRecordingTitle,
                            onRecordingStart: () => ui.elements.recordingInterface.classList.remove('hidden'),
                            onRecordingStop: () => {
                                ui.showPage('recording');
                                ui.elements.processingState.classList.remove('hidden');
                                ui.elements.completedState.classList.add('hidden');
                                ui.elements.processingStatus.textContent = 'Transcribing audio...';
                            },
                            onProcessingComplete: (data, rawText, error) => {
                                app.latestGeneratedReport = { ...data, raw: rawText, error: error?.error };
                                ui.renderCompletedState(app.latestGeneratedReport);
                                ui.elements.processingState.classList.add('hidden');
                                ui.elements.completedState.classList.remove('hidden');
                            }
                        });
                    } catch (e) {
                        console.error("Failed to initialize GoogleGenAI:", e);
                        app.dictationService = null;
                    }
                } else {
                    app.dictationService = null;
                }
                ui.updateRecordButtonState();
            },

            async saveApiKey() {
                const apiKey = ui.elements.apiKeyInput.value.trim();
                if (!apiKey) {
                    ui.elements.apiKeyStatus.textContent = 'Please enter an API key.';
                    ui.elements.apiKeyStatus.classList.replace('text-green-600', 'text-red-600');
                    return;
                }

                ui.elements.saveApiKeyBtn.disabled = true;
                ui.elements.saveApiKeyBtn.textContent = 'Validating...';
                ui.elements.apiKeyStatus.textContent = '';

                try {
                    const testGenAI = new GoogleGenAI({ apiKey });
                    await testGenAI.getGenerativeModel({ model: MODEL_NAME }).generateContent("test");

                    localStorage.setItem('geminiApiKey', apiKey);
                    this.initializeDictationService(apiKey);

                    ui.elements.apiKeyStatus.textContent = 'API Key is valid and saved!';
                    ui.elements.apiKeyStatus.classList.replace('text-red-600', 'text-green-600');

                    setTimeout(() => {
                        ui.elements.apiKeyStatus.textContent = '';
                        if (app.dictationService?.isReady()) ui.showPage('dashboard');
                    }, 2000);

                } catch (error) {
                    console.error("API Key validation failed:", error);
                    localStorage.removeItem('geminiApiKey');
                    this.initializeDictationService(null);

                    ui.elements.apiKeyStatus.textContent = 'Invalid API Key. Please check and try again.';
                    ui.elements.apiKeyStatus.classList.replace('text-green-600', 'text-red-600');
                } finally {
                    ui.elements.saveApiKeyBtn.disabled = false;
                    ui.elements.saveApiKeyBtn.textContent = 'Save Key';
                }
            }
        };

        /**
         * UI module to handle all DOM interactions and updates.
         */
        var ui = {
            elements: {},

            /**
             * Caches all necessary DOM elements into the `elements` object.
             */
            init() {
                const elementIds = [
                    'sidebar', 'mobileMenuBtn', 'ceoView', 'vcView', 'ceoNav', 'vcNav', 'ceoPlaybookList',
                    'playbookCategoryFilters', 'vcPortfolioList', 'page-dashboard', 'page-recording', 'page-reports',
                    'page-playbooks', 'page-integrations', 'page-settings', 'page-vc-dashboard', 'page-vc-playbooks',
                    'page-vc-settings', 'startRecordingBtn', 'newReportBtn', 'recordButton', 'recordingInterface',
                    'processingState', 'processingStatus', 'completedState', 'liveWaveformCanvas',
                    'liveRecordingTimerDisplay', 'liveRecordingTitle', 'recording-status-text',
                    'extractedIntelligenceContainer', 'strategicUpdateContainer', 'authorPlaybookBtn',
                    'apiKeyBanner', 'bannerSettingsLink', 'apiKeyInput', 'saveApiKeyBtn', 'apiKeyStatus',
                    'viewToggle', 'userName', 'userCompany', 'userAvatar', 'ceoLabel', 'vcLabel',
                    'modal', 'modalOverlay', 'modalContent', 'modalTitle', 'modalBody', 'modalCloseBtn'
                ];
                elementIds.forEach(id => {
                    this.elements[id.replace(/-(\w)/g, (match, p1) => p1.toUpperCase())] = document.getElementById(id);
                });

                this.elements.pages = {
                    dashboard: this.elements.pageDashboard, recording: this.elements.pageRecording, reports: this.elements.pageReports,
                    playbooks: this.elements.pagePlaybooks, integrations: this.elements.pageIntegrations, settings: this.elements.pageSettings,
                    vcDashboard: this.elements.pageVcDashboard, vcPlaybooks: this.elements.pageVcPlaybooks, vcSettings: this.elements.pageVcSettings
                };

                this.elements.navLinks = {
                    ceo: { dashboard: document.getElementById('nav-dashboard'), reports: document.getElementById('nav-reports'), playbooks: document.getElementById('nav-playbooks'), integrations: document.getElementById('nav-integrations'), settings: document.getElementById('nav-settings') },
                    vc: { dashboard: document.getElementById('nav-vc-dashboard'), playbooks: document.getElementById('nav-vc-playbooks'), settings: document.getElementById('nav-vc-settings') }
                };
            },

            /**
             * Shows a specific page and hides all others.
             * @param {string} pageName - The name of the page to show.
             */
            showPage(pageName) {
                Object.values(this.elements.pages).forEach(page => page?.classList.add('hidden'));
                this.elements.pages[pageName]?.classList.remove('hidden');

                const navMap = app.currentView === 'ceo' ? this.elements.navLinks.ceo : this.elements.navLinks.vc;
                const navKey = pageName.replace('vc-', '');
                Object.values(navMap).forEach(link => link?.classList.remove('active'));
                navMap[navKey]?.classList.add('active');
                
                if (this.elements.sidebar.classList.contains('translate-x-0')) {
                    this.elements.sidebar.classList.add('-translate-x-full');
                }
            },

            /**
             * Updates the user information in the sidebar.
             * @param {string} name - The user's name.
             * @param {string} company - The user's company.
             * @param {string} avatarSrc - The URL for the user's avatar.
             */
            updateUser(name, company, avatarSrc) {
                this.elements.userName.textContent = name;
                this.elements.userCompany.textContent = company;
                this.elements.userAvatar.src = avatarSrc;
            },

            /**
             * Toggles the active state of the CEO/VC labels.
             * @param {boolean} isVcView - True if the VC view is active.
             */
            toggleLabels(isVcView) {
                this.elements.vcLabel.classList.toggle('font-semibold', isVcView);
                this.elements.vcLabel.classList.toggle('text-purple-700', isVcView);
                this.elements.vcLabel.classList.toggle('text-gray-500', !isVcView);
                this.elements.ceoLabel.classList.toggle('font-semibold', !isVcView);
                this.elements.ceoLabel.classList.toggle('text-purple-700', !isVcView);
                this.elements.ceoLabel.classList.toggle('text-gray-500', isVcView);
            },

            /**
             * Updates the enabled/disabled state of recording buttons based on API key readiness.
             */
            updateRecordButtonState() {
                const isReady = app.dictationService && app.dictationService.isReady();
                const buttons = [this.elements.startRecordingBtn, this.elements.recordButton, this.elements.newReportBtn];
                buttons.forEach(btn => {
                    if (btn) {
                        btn.disabled = !isReady;
                        btn.style.cursor = isReady ? 'pointer' : 'not-allowed';
                        btn.style.opacity = isReady ? '1' : '0.5';
                        btn.title = isReady ? 'Start Recording' : 'API Key not configured';
                    }
                });
                this.elements.apiKeyBanner.classList.toggle('hidden', isReady);
            },

            /**
             * Renders the completed state of a recording, including AI analysis and the strategic update.
             * @param {object} data - The processed data from the recording.
             */
            renderCompletedState(data) {
                if (data.error) {
                    this.elements.extractedIntelligenceContainer.innerHTML = `<h4 class="font-bold text-sm mb-4">Error</h4><div class="bg-white p-6 border border-red-200 rounded-lg"><p class="text-red-600">${data.error}</p></div>`;
                    this.elements.strategicUpdateContainer.innerHTML = `<h4 class="font-bold text-sm mb-4">Strategic Update</h4><div class="bg-white border-2 border-gray-200 p-6 rounded-lg shadow-lg"><p class="text-gray-500">Could not be generated due to an error.</p></div>`;
                    return;
                }

                const renderList = (items) => items && items.length > 0 ? `<ul>${items.map(item => `<li class="flex items-start gap-2"><span class="text-purple-600">→</span><span>${item}</span></li>`).join('')}</ul>` : '<p class="text-gray-500">None mentioned.</p>';
                const fullSummaryHtml = data.fullSummary ? marked.parse(data.fullSummary) : '<p class="text-gray-500">Summary not available.</p>';

                const intelligenceHtml = `
                    <div class="space-y-4">
                        <div><h4 class="font-bold text-sm mb-2 text-green-600">Key Wins</h4>${renderList(data.wins)}</div>
                        <div><h4 class="font-bold text-sm mb-2 text-amber-600">Key Challenges</h4>${renderList(data.challenges)}</div>
                        <div><h4 class="font-bold text-sm mb-2 text-blue-600">Strategic Insights</h4>${renderList(data.insights)}</div>
                        <div class="pt-4 border-t"><h4 class="font-bold text-sm mb-2">Full Transcript</h4><p class="text-xs italic text-gray-500 max-h-32 overflow-y-auto">${data.raw || 'Not available.'}</p></div>
                    </div>`;
                this.elements.extractedIntelligenceContainer.querySelector('.bg-white').innerHTML = intelligenceHtml;
                
                const strategicHtml = `
                    <div class="flex items-center justify-between mb-6"><div><h3 class="font-bold text-xl">Strategic Update</h3><p class="text-sm text-gray-600 mono">Week ${new Date().getWeek()} • ${new Date().getFullYear()}</p></div><span class="text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full">Momentum Building</span></div>
                     <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="text-center p-3 bg-gray-50 rounded"><p class="font-bold text-xl">${data.arr || 'N/A'}</p><p class="text-xs text-gray-600">ARR</p></div>
                        <div class="text-center p-3 bg-gray-50 rounded"><p class="font-bold text-xl ${data.growth && data.growth.startsWith('+') ? 'text-green-600' : 'text-red-600'}">${data.growth || 'N/A'}</p><p class="text-xs text-gray-600">Growth</p></div>
                        <div class="text-center p-3 bg-gray-50 rounded"><p class="font-bold text-xl">${data.runway || 'N/A'}</p><p class="text-xs text-gray-600">Runway</p></div>
                    </div>
                    <div class="prose prose-sm max-w-none">${fullSummaryHtml}</div>
                    <button id="finalize-report-btn-2" class="mt-6 w-full bg-purple-700 text-white py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">Finalize & Share →</button>
                `;
                this.elements.strategicUpdateContainer.querySelector('.bg-white').innerHTML = strategicHtml;
            },

            /**
             * Shows a modal with the given title and body content.
             * @param {string} title - The title of the modal.
             * @param {HTMLElement} body - The HTML element to be placed in the modal body.
             */
            showModal(title, body) {
                this.elements.modalTitle.textContent = title;
                this.elements.modalBody.innerHTML = '';
                this.elements.modalBody.appendChild(body);
                this.elements.modal.classList.remove('hidden');
                setTimeout(() => {
                    this.elements.modalOverlay.classList.remove('opacity-0');
                    this.elements.modalContent.classList.remove('scale-95', 'opacity-0');
                }, 10);
            },

            /**
             * Hides the currently visible modal.
             */
            hideModal() {
                ui.elements.modalOverlay.classList.add('opacity-0');
                ui.elements.modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => ui.elements.modal.classList.add('hidden'), 300);
            },

            showShareModal() {
                const content = document.createElement('div');
                content.innerHTML = `
                    <p class="text-sm text-gray-600 mb-4">Share this report with your stakeholders.</p>
                    <div class="mb-6"> <label class="text-sm font-bold text-gray-700">Shareable Link</label> <div class="flex mt-1"> <input id="share-link-input" type="text" readonly value="https://operal.ta/r/8ab3f-cde21" class="mono text-sm flex-1 p-2 border border-gray-300 rounded-l-md bg-gray-50"> <button id="copy-link-btn" class="bg-gray-200 px-4 py-2 text-sm font-semibold rounded-r-md hover:bg-gray-300">Copy</button> </div> </div>
                    <div> <label class="text-sm font-bold text-gray-700">Send to Stakeholders</label> <div class="mt-2 border border-gray-200 rounded-md"> <div class="p-3 flex items-center justify-between"><span class="font-semibold">Alpha Ventures</span><span class="text-xs text-gray-500">sarah@alphavc.com</span></div> <div class="p-3 border-t border-gray-200 flex items-center justify-between"><span class="font-semibold">Seed Fund Inc.</span><span class="text-xs text-gray-500">updates@seed.inc</span></div> </div> </div>
                    <button id="send-update-btn" class="w-full bg-purple-700 text-white py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md mt-6">Send Update</button>`;
                this.showModal('Share Report', content);
            },

            showViewReportModal(reportId) {
                const report = db.reports[reportId];
                if (!report) return;
                const content = document.createElement('div');
                const growthClass = report.metrics.growth.startsWith('+') ? 'text-green-600' : 'text-red-600';
                content.innerHTML = `
                    <div class="grid grid-cols-3 gap-4 mb-6 text-center">
                        <div><p class="font-bold text-2xl">${report.metrics.arr}</p><p class="text-xs text-gray-600">ARR</p></div>
                        <div><p class="font-bold text-2xl ${growthClass}">${report.metrics.growth}</p><p class="text-xs text-gray-600">MoM Growth</p></div>
                        <div><p class="font-bold text-2xl">${report.metrics.runway}</p><p class="text-xs text-gray-600">Runway</p></div>
                    </div>
                    <div class="prose prose-sm max-w-none">${report.content}</div>`;
                this.showModal(report.title, content);
            },

            showCompanyDetailModal(companyId) {
                const company = db.companies[companyId];
                if (!company) return;
                const statusClass = company.status === 'On Track' ? 'text-green-600 bg-green-100' : 'text-yellow-600 bg-yellow-100';
                const content = document.createElement('div');
                content.innerHTML = `
                    <div class="mb-6">
                        <div class="flex justify-between items-start">
                             <h3 class="text-lg font-bold">Status Overview</h3>
                             <span class="px-2 py-1 text-xs font-semibold ${statusClass} rounded-full">${company.status}</span>
                        </div>
                        <div class="mt-4 grid grid-cols-3 gap-4 text-center">
                           <div><p class="font-bold text-2xl">${company.metrics.arr}</p><p class="text-xs text-gray-600">ARR</p></div>
                            <div><p class="font-bold text-2xl ${company.metrics.growth.startsWith('+') ? 'text-green-600' : 'text-red-600'}">${company.metrics.growth}</p><p class="text-xs text-gray-600">MoM Growth</p></div>
                            <div><p class="font-bold text-2xl">${company.metrics.runway}</p><p class="text-xs text-gray-600">Runway</p></div>
                        </div>
                    </div>
                    <div class="mb-6">
                        <h3 class="text-lg font-bold mb-3">Last 4 Weeks Updates</h3>
                        <div class="space-y-2 text-sm">
                            <a href="#" class="flex justify-between p-2 rounded-md hover:bg-gray-50 view-report-link" data-report-id="${companyId}"><span class="font-semibold">W36 Update</span><span class="text-gray-500">Sep 5, 2025</span></a>
                            <a href="#" class="flex justify-between p-2 rounded-md hover:bg-gray-50 view-report-link" data-report-id="${companyId}"><span class="font-semibold">W35 Update</span><span class="text-gray-500">Aug 29, 2025</span></a>
                        </div>
                    </div>
                     <div>
                        <h3 class="text-lg font-bold mb-3">Recommended Playbooks</h3>
                        <div class="space-y-2 text-sm">
                           <a href="#" class="flex justify-between p-2 rounded-md hover:bg-gray-50 playbook-link" data-playbook-id="enterprise-sales"><span class="font-semibold">Enterprise Sales Playbook</span><span class="text-gray-500 mono text-xs">SALESFORCE</span></a>
                           <a href="#" class="flex justify-between p-2 rounded-md hover:bg-gray-50 playbook-link" data-playbook-id="eng-hiring"><span class="font-semibold">Scaling Engineering Teams</span><span class="text-gray-500 mono text-xs">REVOLUT</span></a>
                        </div>
                    </div>`;
                this.showModal(company.name, content);
            },

            showPlaybookModal(playbookId) {
                const playbook = db.playbooks[playbookId];
                if (!playbook) return;
                const content = document.createElement('div');
                content.innerHTML = `
                    <div class="prose prose-sm max-w-none">${playbook.content}</div>
                    <div class="mt-6 pt-4 border-t border-gray-200 flex space-x-4">
                         <button class="flex-1 bg-purple-100 text-purple-700 px-4 py-2 text-sm font-bold hover:bg-purple-200 transition-colors rounded-md">Add to AI-Coach</button>
                         <button class="flex-1 bg-gray-200 text-gray-800 px-4 py-2 text-sm font-bold hover:bg-gray-300 transition-colors rounded-md">Read</button>
                    </div>`;
                this.showModal(playbook.title, content);
            },
            
            showAuthorPlaybookModal() {
                const content = document.createElement('div');
                content.innerHTML = `
                    <div class="space-y-4">
                        <div><label class="text-sm font-bold text-gray-700">Playbook Title</label><input type="text" placeholder="e.g., Our Guide to Board Meetings" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></div>
                        <div><label class="text-sm font-bold text-gray-700">Content (Markdown supported)</label><textarea rows="8" placeholder="### Key Principles..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea></div>
                    </div>
                    <div class="flex justify-between items-center mt-6">
                        <button id="share-playbook-btn" class="bg-gray-200 text-gray-800 px-4 py-2 text-sm font-bold hover:bg-gray-300 rounded-md">Share with Portfolio</button>
                        <button id="save-playbook-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 rounded-md">Save Playbook</button>
                    </div>`;
                this.showModal('Author New Playbook', content);
            },
            
            /**
             * Creates the HTML for a single playbook card.
             * @param {object} playbook - The playbook data.
             * @param {string} id - The playbook ID.
             * @returns {string} The HTML string for the card.
             */
            _createPlaybookCardHtml(playbook, id) {
                return `
                    <div class="bg-white border border-gray-200 p-4 rounded-lg flex justify-between items-center group">
                        <div>
                            <p class="font-semibold">${playbook.title}</p>
                            <p class="text-sm text-gray-500">from ${playbook.company}</p>
                        </div>
                        <button class="playbook-view-btn text-xs bg-gray-200 text-gray-700 px-3 py-1 rounded-full font-semibold hover:bg-gray-300" data-playbook-id="${id}">View</button>
                    </div>`;
            },

            populateCeoPlaybooks() {
                const activeCategories = Array.from(this.elements.playbookCategoryFilters.querySelectorAll('.playbook-category-btn.active')).map(btn => btn.dataset.category);
                const categories = { 'Growth': [], 'Hiring': [], 'Fundraising': [], 'Product': [], 'Sales': [], 'Legal': [] };
                const visiblePlaybooks = Object.entries(db.playbooks).filter(([id, playbook]) => playbook.category && (activeCategories.length === 0 || activeCategories.includes(playbook.category)));

                if (visiblePlaybooks.length === 0) {
                    this.elements.ceoPlaybookList.innerHTML = `<div class="text-center text-gray-500 col-span-full">No playbooks found for the selected categories.</div>`;
                    return;
                }

                visiblePlaybooks.forEach(([id, p]) => {
                    const html = this._createPlaybookCardHtml(p, id);
                    if(categories[p.category]) categories[p.category].push(html);
                });
                
                let fullHtml = '';
                for (const [categoryName, items] of Object.entries(categories)) {
                    if (items.length) {
                        fullHtml += `<div><h3 class="font-bold mb-4 pb-2 border-b border-gray-200">${categoryName}</h3><div class="space-y-4 text-sm">${items.join('')}</div></div>`;
                    }
                }
                this.elements.ceoPlaybookList.innerHTML = fullHtml;
            },

            /**
             * Creates the HTML for a single company card.
             * @param {object} company - The company data.
             * @param {string} id - The company ID.
             * @returns {string} The HTML string for the card.
             */
            _createCompanyCardHtml(company, id) {
                const statusClass = company.status === 'On Track' ? 'text-green-800 bg-green-100' : 'text-yellow-800 bg-yellow-100';
                const growthClass = company.metrics.growth.startsWith('+') ? 'text-green-600' : 'text-red-600';
                return `
                    <div class="bg-white border border-gray-200 p-6 rounded-lg cursor-pointer hover:shadow-lg transition-shadow" data-company-id="${id}">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-bold">${company.name}</h3>
                            <span class="px-2 py-1 text-xs font-semibold ${statusClass} rounded-full">${company.status}</span>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div class="border-r border-gray-200"><p class="text-lg font-bold">${company.metrics.arr}</p><p class="text-xs text-gray-500">ARR</p></div>
                            <div class="border-r border-gray-200"><p class="text-lg font-bold ${growthClass}">${company.metrics.growth}</p><p class="text-xs text-gray-500">MoM</p></div>
                            <div><p class="text-lg font-bold">${company.metrics.runway}</p><p class="text-xs text-gray-500">Runway</p></div>
                        </div>
                    </div>`;
            },

            populateVcPortfolio() {
                const html = Object.entries(db.companies)
                    .map(([id, company]) => this._createCompanyCardHtml(company, id))
                    .join('');
                this.elements.vcPortfolioList.innerHTML = html;
            }
        };

        var db = {
            companies: {
                innovate: { name: 'Innovate Inc.', status: 'On Track', metrics: { arr: '€2.1M', growth: '+18%', runway: '24mo' } },
                quantum: { name: 'QuantumLeap', status: 'Needs Attention', metrics: { arr: '€800K', growth: '-5%', runway: '9mo' } },
                synergy: { name: 'Synergy AI', status: 'On Track', metrics: { arr: '€4.5M', growth: '+25%', runway: '16mo' } },
                dataforge: { name: 'DataForge', status: 'On Track', metrics: { arr: '€1.5M', growth: '+12%', runway: '20mo' } },
                nextech: { name: 'NexTech', status: 'On Track', metrics: { arr: '€3.2M', growth: '+15%', runway: '18mo' } },
                cloudscape: { name: 'Cloudscape', status: 'Needs Attention', metrics: { arr: '€950K', growth: '+2%', runway: '11mo' } },
                biogen: { name: 'BioGen', status: 'On Track', metrics: { arr: '€1.8M', growth: '+20%', runway: '22mo' } },
                finwise: { name: 'FinWise', status: 'On Track', metrics: { arr: '€5.1M', growth: '+19%', runway: '15mo' } },
                logix: { name: 'Logix', status: 'On Track', metrics: { arr: '€2.8M', growth: '+14%', runway: '19mo' } },
                zenith: { name: 'Zenith VR', status: 'On Track', metrics: { arr: '€1.1M', growth: '+30%', runway: '14mo' } },
            },
            reports: {
                w36: { title: 'Weekly Update - W36', date: 'Sep 5, 2025', metrics: { arr: '€1.2M', growth: '+23%', runway: '18mo' }, content: '<h3>Wins</h3><ul><li>Strong month with 23% MoM growth.</li><li>Closed 3 enterprise deals totaling €240k in new ARR.</li></ul><h3>Challenges</h3><ul><li>Engineering hiring remains top priority.</li></ul>' },
                w35: { title: 'Weekly Update - W35', date: 'Aug 29, 2025', metrics: { arr: '€1.1M', growth: '+15%', runway: '19mo' }, content: '<h3>Wins</h3><ul><li>Onboarded 2 major enterprise clients: Globex Corp and Innovate LLC.</li><li>Successful launch of the new analytics dashboard.</li></ul><h3>Next Steps</h3><ul><li>Begin planning for Series A raise in Q1 2026.</li></ul>' },
                w34: { title: 'Weekly Update - W34', date: 'Aug 22, 2025', metrics: { arr: '€1.05M', growth: '+5%', runway: '20mo' }, content: '<h3>Challenges</h3><ul><li>Unexpected churn from a mid-market customer.</li><li>Technical debt is slowing down feature development.</li></ul>' },
                innovate: { title: 'Weekly Update - Innovate Inc.', date: 'Sep 5, 2025', metrics: { arr: '€2.1M', growth: '+18%', runway: '24mo' }, content: '<h3>Wins</h3><ul><li>Product-market fit scores are at an all-time high after the v2.1 launch.</li><li>Closed a strategic partnership with a major distributor.</li></ul>' },
                quantum: { title: 'Weekly Update - QuantumLeap', date: 'Sep 5, 2025', metrics: { arr: '€800K', growth: '-5%', runway: '9mo' }, content: '<h3>Challenges</h3><ul><li>Marketing experiment with paid social showed higher than expected CAC.</li><li>Key engineering hire resigned.</li></ul><h3>Next Steps</h3><ul><li>Focusing on organic channels for Q4.</li><li>Opening up search for a new lead engineer.</li></ul>' },
                synergy: { title: 'Weekly Update - Synergy AI', date: 'Sep 5, 2025', metrics: { arr: '€4.5M', growth: '+25%', runway: '16mo' }, content: '<h3>Wins</h3><ul><li>Landed our first F500 customer.</li><li>Team morale is very high after the offsite.</li></ul>' },
            },
            playbooks: {
                'plg': { category: 'Growth', title: 'Product-Led Growth Engine', company: 'SLACK', content: '<h3>Key Idea</h3><p>Focus on making the product itself the primary driver of user acquisition, conversion, and expansion.</p><ul><li>Freemium model to reduce friction.</li><li>Seamless user onboarding.</li><li>Built-in virality (e.g., inviting colleagues).</li></ul>' },
                'outbound': { category: 'Growth', title: 'Outbound Sales Cadence', company: 'HUBSPOT', content: '<h3>Key Idea</h3><p>A structured sequence of touchpoints (email, call, social) to engage prospects.</p><ol><li>Day 1: Personalized Email</li><li>Day 3: LinkedIn Connection Request</li><li>Day 5: Follow-up Email + Call</li></ol>' },
                'eng-hiring': { category: 'Hiring', title: 'Scaling Engineering Teams', company: 'REVOLUT', content: `<h3>Key Principles</h3><ul><li><strong>Hire for Slope, Not Just Experience:</strong> Look for candidates with a steep learning curve and high potential, not just years on a resume.</li><li><strong>Bar Raiser Interviews:</strong> Involve a senior engineer from a different team in the final interview loop to maintain a consistently high bar for talent.</li><li><strong>Practical Problem Solving:</strong> Use a take-home project or a pair-programming session that mirrors real-world work.</li></ul>` },
                'remote': { category: 'Hiring', title: 'Remote Transformation', company: 'GITLAB', content: '<h3>Key Idea</h3><p>Build a thriving, productive company with no physical offices.</p><ul><li>Document everything in a central handbook.</li><li>Promote asynchronous communication.</li><li>Invest in tools for remote collaboration.</li></ul>' },
                'seed-deck': { category: 'Fundraising', title: 'The Perfect Seed Deck', company: 'Y COMBINATOR', content: `<h3>The 10-Slide Structure</h3><ol><li>Title</li><li>Problem</li><li>Solution</li><li>Market Size</li><li>Product</li><li>Traction</li><li>Team</li><li>Competition</li><li>Business Model</li><li>The Ask</li></ol>` },
                'board-meeting': { category: 'Fundraising', title: 'Board Meeting Excellence', company: 'SPOTIFY', content: '<h3>Key Idea</h3><p>Structure board meetings around strategic decisions, not just updates.</p><ul><li>Send materials 48 hours in advance.</li><li>Focus 80% of time on forward-looking strategy.</li><li>Use a data-driven appendix for metrics.</li></ul>' },
                'product-docs': { category: 'Product', title: 'Writing Great Product Docs', company: 'INTERCOM', content: '<h3>Key Idea</h3><p>Structure product docs around the "Why, What, and How" to ensure clarity for the entire team.</p><ul><li><strong>Why:</strong> The problem you are solving and for whom.</li><li><strong>What:</strong> The scope of the feature, including user stories and success metrics.</li><li><strong>How:</strong> High-level technical approach and design mocks.</li></ul>' },
                'user-interviews': { category: 'Product', title: 'Effective User Interviews', company: 'STRIPE', content: '<h3>Key Idea</h3><p>Ask open-ended questions about past behavior, not future intentions. Focus on understanding their problems deeply rather than pitching your solution.</p>' },
                'enterprise-sales': { category: 'Sales', title: 'Enterprise Sales Playbook', company: 'SALESFORCE', content: '<h3>Key Idea</h3><p>Navigate complex sales cycles by mapping the organization, identifying the champion, economic buyer, and technical buyer, and building consensus across the buying committee.</p>' },
                'saas-pricing': { category: 'Sales', title: 'Value-Based SaaS Pricing', company: 'TWILIO', content: '<h3>Key Idea</h3><p>Price your product based on the value it delivers to the customer segment, not on your costs or competitor prices. Common models include per-user, usage-based, and tiered pricing.</p>' },
                'cap-table': { category: 'Legal', title: 'Cap Table Management', company: 'CARTA', content: '<h3>Key Idea</h3><p>Maintain a clean and accurate capitalization table from day one. It is the single source of truth for company ownership and is critical for fundraising and employee equity.</p>' },
                'nda': { category: 'Legal', 'title': 'When to Use an NDA', 'company': 'WILSON SONSINI', content: '<h3>Key Idea</h3><p>Use Non-Disclosure Agreements sparingly. They are standard for M&A or deep strategic partnerships, but create unnecessary friction when talking to most VCs or potential hires.</p>' },
                'board-meetings': { title: "Our Guide to Board Meetings", content: "<h3>The Atomic Ventures Board Meeting Framework</h3><p>The essential template and best practices for running an effective board meeting that drives decisions, not just reporting.</p><ol><li><strong>Pre-Meeting:</strong> Send a concise pre-read 72 hours in advance, highlighting key decisions needed.</li><li><strong>Meeting Structure:</strong> 10% review of past performance, 60% strategic discussion on 2-3 key topics, 30% open discussion and administrative.</li><li><strong>Post-Meeting:</strong> Send minutes and action items within 24 hours.</li></ol>" },
                'term-sheet': { title: "Term Sheet Negotiation 101", content: "<h3>Key Terms for Founders</h3><p>Key terms and strategies for a successful fundraise, focusing on founder-friendly outcomes.</p><ul><li><strong>Valuation:</strong> Understand pre-money vs. post-money.</li><li><strong>Liquidation Preference:</strong> Aim for 1x, non-participating.</li><li><strong>Board Composition:</strong> Ensure founder control or a balanced board.</li><li><strong>Vesting:</strong> Standard is 4-year vest with a 1-year cliff.</li></ul>" }
            }
        };

        Date.prototype.getWeek = function() { var d = new Date(Date.UTC(this.getFullYear(), this.getMonth(), this.getDate())); var dayNum = d.getUTCDay() || 7; d.setUTCDate(d.getUTCDate() + 4 - dayNum); var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1)); return Math.ceil((((d - yearStart) / 86400000) + 1)/7) };

        app.init();
    </script>
</body>
</html>

