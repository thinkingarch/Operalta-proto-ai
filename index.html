<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operalta — Platform Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        :root {
            --grid-color: #f0f0f0;
            --accent: #5B21B6;
            --color-recording: #ff3b30;
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(0, 0, 0, 0.07);
            --glass-shadow: rgba(0, 0, 0, 0.05);
            --glass-recording-bg: rgba(248, 248, 248, 0.75);
            --glass-recording-border: rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Space Grotesk', -apple-system, sans-serif;
            background-color: #f9fafb;
        }
        
        .mono {
            font-family: 'Space Mono', monospace;
        }

        .baseline-grid {
            background-image: linear-gradient(var(--grid-color) 1px, transparent 1px);
            background-size: 100% 16px;
        }
        
        .sidebar-link { transition: all 0.2s ease; }
        .sidebar-link:hover, .sidebar-link.active { background-color: #f3f4f6; color: #111827; }
        .sidebar-link.active { font-weight: 600; }
        #sidebar { transition: transform 0.3s ease-in-out; }

        /* CEO/VC Toggle Switch */
        .toggle-dot { transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        input:checked ~ .toggle-bg { background-color: var(--accent); }
        input:checked ~ .toggle-dot { transform: translateX(100%); }

        /* Dictation App Styles Integration */
        .recording-interface {
            transition: all 0.45s ease-in-out;
            z-index: 10;
        }
        .recording-interface.is-live {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: 350px;
            z-index: 1000;
            background-color: var(--glass-recording-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-recording-border);
            box-shadow: 0 -4px 20px var(--glass-shadow);
            justify-content: flex-start;
            padding: 20px;
        }
        .live-recording-title, #liveWaveformCanvas, .live-recording-timer {
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.3s ease-out 0.1s, transform 0.35s ease-out 0.1s;
        }
        .recording-interface.is-live .live-recording-title,
        .recording-interface.is-live #liveWaveformCanvas,
        .recording-interface.is-live .live-recording-timer {
            opacity: 1;
            transform: translateY(0);
        }
        #liveWaveformCanvas { width: 100%; max-width: 340px; height: 70px; margin-bottom: 18px; border-radius: 4px; }
        .live-recording-timer { font-family: 'Space Mono', monospace; font-size: 44px; font-weight: 400; margin-bottom: 22px; text-align: center; }
        
        .record-button { position: relative; width: 72px; height: 72px; border-radius: 50%; border: none; outline: none; background: none; cursor: pointer; z-index: 1; }
        .record-button-inner { position: relative; width: 100%; height: 100%; border-radius: 50%; background: var(--glass-bg); border: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: center; color: #111827; font-size: 24px; z-index: 2; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }
        .record-button:hover .record-button-inner { transform: scale(1.08); }
        .record-button.recording .record-button-inner { background-color: var(--color-recording); border-color: transparent; color: white; }

        @keyframes wave { 0% { transform: scale(0.4); opacity: 0.8; } 100% { transform: scale(1.8); opacity: 0; } }
        .record-waves { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; z-index: 1; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .record-button.recording .record-waves { opacity: 1; }
        .wave { fill: none; stroke: var(--color-recording); stroke-width: 1.5px; opacity: 0; transform-origin: center; }
        .record-button.recording .wave1 { animation: wave 2s infinite ease-out; }
        .record-button.recording .wave2 { animation: wave 2s infinite ease-out 0.4s; }
        
        .notion-block {
            border-left: 3px solid var(--accent);
            padding-left: 1rem;
            margin-top: 0.5rem;
        }
        
        /* Modal Styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        /* Playbook Category Filter */
        .playbook-category-btn { transition: all 0.2s ease; border: 1px solid #e5e7eb; }
        .playbook-category-btn.active, .playbook-category-btn:hover {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Styles for playbook content in modal */
        .playbook-step {
            margin-bottom: 1.5rem;
        }
        .playbook-step h3 {
            font-weight: 700;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #4f46e5;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.25rem;
        }
        .playbook-step p, .playbook-step ul, .playbook-step ol {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #374151;
        }
        .playbook-step ul, .playbook-step ol {
            padding-left: 1.25rem;
            margin-top: 0.5rem;
        }
        .playbook-step li {
            margin-bottom: 0.25rem;
        }
        
        /* Conversational Guide styles */
        .guide-step-indicator {
            transition: all 0.3s ease;
            flex: 1;
        }
        .guide-step-indicator.active {
            background-color: var(--accent);
        }
        .guide-step-indicator.completed {
            background-color: #a78bfa; /* Lighter purple */
        }
        .ai-bubble {
            background-color: #f3f4f6;
            border-bottom-left-radius: 0.25rem;
        }
        .user-bubble {
            background-color: #eef2ff;
            border-bottom-right-radius: 0.25rem;
        }

        .input-wrapper {
            position: relative;
            width: 100%;
        }
        .input-wrapper textarea {
            width: 100%;
            padding-right: 2.5rem; /* space for the icon */
        }
        .input-wrapper .mic-icon {
            position: absolute;
            top: 50%;
            right: 0.75rem;
            transform: translateY(-50%);
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .input-wrapper .mic-icon:hover {
            color: var(--accent);
        }
        
        /* AI Suggestion styles */
        .ai-suggestion {
            background-color: #fefce8; /* yellow-50 */
            border: 1px solid #fde047; /* yellow-300 */
            border-radius: 0.375rem;
            padding: 0.75rem;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #854d0e; /* yellow-800 */
        }
        .ai-suggestion strong {
            color: #ca8a04; /* yellow-600 */
        }
    </style>
     <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^0.8.0",
          "marked": "https://esm.sh/marked@^4.0.0"
        }
      }
    </script>
</head>
<body class="text-gray-900 overflow-x-hidden">

    <div class="relative min-h-screen md:flex">
        <!-- Mobile Header -->
        <div class="md:hidden flex justify-between items-center bg-white border-b border-gray-200 p-4 sticky top-0 z-40">
            <a href="#" class="font-bold text-lg tracking-wider flex items-center gap-3">
                <div class="w-8 h-8 bg-gray-800 rounded-md flex items-center justify-center text-white text-sm mono">OA</div>
                <span>Operalta</span>
            </a>
            <button id="mobile-menu-btn">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>

        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="w-64 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col fixed inset-y-0 left-0 z-50 transform -translate-x-full md:relative md:translate-x-0">
            <div class="h-16 flex items-center px-6 border-b border-gray-200">
                <a href="#" class="font-bold text-lg tracking-wider flex items-center gap-3">
                    <div class="w-8 h-8 bg-gray-800 rounded-md flex items-center justify-center text-white text-sm mono">OA</div>
                    <span>Operalta</span>
                </a>
            </div>
            
            <nav id="ceo-nav" class="flex-1 px-4 py-6 space-y-2">
                <a href="#" id="nav-dashboard" class="sidebar-link active flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>Dashboard</a>
                <a href="#" id="nav-reports" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>Reports</a>
                <a href="#" id="nav-playbooks" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18"></path></svg>Playbooks</a>
                <a href="#" id="nav-integrations" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>Integrations</a>
                <a href="#" id="nav-settings" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0 3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>Settings</a>
            </nav>
            <nav id="vc-nav" class="hidden flex-1 px-4 py-6 space-y-2">
                <a href="#" id="nav-vc-dashboard" class="sidebar-link active flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2a4 4 0 00-4-4H3s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1h-2a4 4 0 00-4 4v2"></path><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"></path><path d="M17.63 17.63A4 4 0 1014 14a4 4 0 003.63 3.63z"></path></svg>Portfolio</a>
                <a href="#" id="nav-vc-playbooks" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18"></path></svg>Playbooks</a>
                 <a href="#" id="nav-vc-settings" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0 3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>Settings</a>
            </nav>
            
             <div class="px-4 py-4 mt-auto border-t border-gray-200">
                <div class="flex items-center mb-4">
                    <img id="user-avatar" class="h-8 w-8 rounded-full object-cover" src="https://placehold.co/100x100/5B21B6/FFFFFF?text=A" alt="User Avatar">
                    <div class="ml-3">
                        <p id="user-name" class="text-sm font-semibold text-gray-800">Alex (CEO)</p>
                        <p id="user-company" class="text-xs text-gray-500">Acme Inc.</p>
                    </div>
                </div>
                 <div class="mt-4 text-xs mono">
                    <span class="font-semibold text-gray-700">Account</span>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1">
            <div id="ceo-view">
                <div id="page-dashboard" class="p-4 sm:p-8 md:p-12 baseline-grid">
                    <div id="api-key-banner" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded-r-lg" role="alert">
                        <p class="font-bold">Action Required</p>
                        <p>Please <a href="#" id="banner-settings-link" class="underline font-semibold">add your Gemini API key</a> in the settings to enable recording.</p>
                    </div>
                    <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">CEO Dashboard</h1><p class="text-gray-500 mt-1 mono text-sm">Wednesday, October 8, 2025</p></header>
                    
                    <div class="bg-white p-6 sm:p-8 border border-gray-200 rounded-lg shadow-sm mb-8">
                        <h2 class="text-lg font-bold mb-4">Live Business Context</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 text-sm">
                            <div class="space-y-1">
                                <h3 class="font-bold text-red-600">Sales Pipeline Attention</h3>
                                <p class="text-gray-600">Globex Corp: Stalled in Negotiation ($120k)</p>
                                <p class="text-xs text-gray-400">Source: <a href="#" class="text-purple-700 hover:underline">Hubspot</a></p>
                            </div>
                            <div class="space-y-1">
                                <h3 class="font-bold">Financials</h3>
                                <p class="text-gray-600">ARR: $1.2M | MRR: $100k | CAC: $5.2k</p>
                                <p class="text-xs text-gray-400">Source: <span class="text-gray-500">BREX</span></p>
                            </div>
                            <div class="space-y-1">
                                <h3 class="font-bold">Recruitment</h3>
                                <p class="text-gray-600">New Hires (Q3): 3 | Open Roles: 2</p>
                                <p class="text-xs text-gray-400">Source: <span class="text-gray-500">DEEL</span></p>
                            </div>
                             <div class="space-y-1">
                                <h3 class="font-bold">Product</h3>
                                <p class="text-gray-600">PMF Score: 42% (Superhuman method)</p>
                                <p class="text-xs text-gray-400">Source: <span class="text-gray-500">Notion</span></p>
                            </div>
                             <div class="space-y-1">
                                <h3 class="font-bold">Previous Monthly Reports</h3>
                                <p class="text-gray-600">July, August | Growth stable at ~7% MoM</p>
                                <p class="text-xs text-gray-400">Source: <span class="text-gray-500">Notion</span></p>
                            </div>
                            <div class="bg-purple-50 border border-purple-200 rounded-md p-4 md:col-span-2 lg:col-span-3">
                                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                                    <div>
                                        <h3 class="font-bold">Weekly Report - October 7th 2025 (Draft)</h3>
                                        <p class="text-gray-600 mt-1">Based on September data: Est. ARR $1.25M (+4%), Proj. CAC $5.8k (+11%)</p>
                                         <p class="text-xs text-gray-400 mt-1">Sources: Notion, BREX, DEEL</p>
                                    </div>
                                    <button id="review-draft-report-btn" class="mt-2 sm:mt-0 text-sm bg-purple-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-purple-700 whitespace-nowrap">Review Full Draft</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 sm:p-8 border border-gray-200 rounded-lg shadow-sm mb-8"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4"><h2 class="text-lg font-bold">Create Weekly Update</h2><span class="text-xs mono text-gray-500 mt-1 sm:mt-0">Voice Memo → AI Synthesis → Investor Report</span></div><div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6"><button id="start-recording-btn" class="w-16 h-16 bg-purple-700 text-white rounded-full flex items-center justify-center hover:bg-purple-800 transition-all transform hover:scale-105 shadow-lg flex-shrink-0"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg></button><div class="flex-1"><p class="font-semibold">Record a 5-minute voice memo</p><p class="text-sm text-gray-600">Summarize your week: wins, challenges, and key metrics. Our AI will do the rest.</p></div></div></div>
                     <div class="bg-white p-6 sm:p-8 border border-gray-200 rounded-lg shadow-sm">
                        <h2 class="text-lg font-bold mb-4">Recent Activity</h2>
                        <ul class="space-y-3 text-sm">
                            <li class="flex items-start gap-3">
                                <span class="text-gray-400 mt-1"><i class="fas fa-file-alt"></i></span>
                                <div><a href="#" class="font-semibold text-purple-700 hover:underline nav-link" data-page="reports">Drafting October 7 2025 Weekly Report</a><p class="text-xs text-gray-500">2 days ago</p></div>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="text-gray-400 mt-1"><i class="fas fa-check-circle"></i></span>
                                <div><a href="#" class="font-semibold text-purple-700 hover:underline nav-link" data-page="playbooks">Completed "Unit Economics Deep Dive" Playbook</a><p class="text-xs text-gray-500">3 days ago</p></div>
                            </li>
                             <li class="flex items-start gap-3">
                                <span class="text-gray-400 mt-1"><i class="fas fa-paper-plane"></i></span>
                                <div><a href="#" class="font-semibold text-purple-700 hover:underline nav-link" data-page="reports">Sent Q3 2025 Quarterly Report</a><p class="text-xs text-gray-500">7 days ago</p></div>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div id="page-recording" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">New Weekly Update</h1></header>
                    <div id="processing-state" class="hidden text-center py-16"><div class="inline-block w-8 h-8 border-2 border-purple-700 border-t-transparent rounded-full animate-spin mb-4"></div><h3 id="processing-status" class="font-bold">Processing audio...</h3><p class="text-sm text-gray-600 mt-2">This usually takes less than a minute.</p></div>
                    <div id="completed-state" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-12">
                        <!-- AI Analysis -->
                        <div id="extracted-intelligence">
                             <h4 class="font-bold text-sm mb-4">Extracted Intelligence</h4>
                             <div class="bg-white p-6 border border-gray-200 rounded-lg space-y-4">
                                <!-- Content injected here -->
                             </div>
                        </div>
                        <!-- Strategic Update -->
                        <div id="strategic-update">
                            <h4 class="font-bold text-sm mb-4">Strategic Update</h4>
                            <div class="bg-white border-2 border-gray-200 p-6 rounded-lg shadow-lg">
                                <!-- Content injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="page-reports" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8 flex justify-between items-center">
                        <div>
                            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Reports</h1>
                            <p class="text-gray-500 mt-1 mono text-sm">History of all generated investor updates.</p>
                        </div>
                        <button id="new-report-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">New Report</button>
                    </header>
                    <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50"><tr class="text-left text-xs text-gray-500 uppercase tracking-wider"><th class="p-4 font-semibold">Date</th><th class="p-4 font-semibold">Title</th><th class="p-4 font-semibold">Status</th><th class="p-4 font-semibold hidden md:table-cell">Key Metric</th><th class="p-4"></th></tr></thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr><td class="p-4">Oct 7, 2025</td><td class="p-4 font-semibold">Weekly Report - October 2025</td><td class="p-4"><span class="px-2 py-1 text-xs font-semibold text-yellow-800 bg-yellow-100 rounded-full">Draft</span></td><td class="p-4 hidden md:table-cell">ARR $1.25M (+4%)</td><td class="p-4 text-right"><a href="#" class="text-purple-700 hover:underline view-report-link" data-report-id="september2025">View</a></td></tr>
                                <tr><td class="p-4">Oct 1, 2025</td><td class="p-4 font-bold text-purple-700">Q3 2025 Quarterly Report</td><td class="p-4"><span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full">Sent</span></td><td class="p-4 hidden md:table-cell">15% QoQ ARR Growth</td><td class="p-4 text-right"><a href="#" class="text-purple-700 hover:underline view-report-link" data-report-id="q3-2025">View</a></td></tr>
                                <tr><td class="p-4">Sep 1, 2025</td><td class="p-4 font-semibold">Monthly Report - August 2025</td><td class="p-4"><span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full">Sent</span></td><td class="p-4 hidden md:table-cell">ARR $1.2M (+9%)</td><td class="p-4 text-right"><a href="#" class="text-purple-700 hover:underline view-report-link" data-report-id="august2025">View</a></td></tr>
                                <tr><td class="p-4">Aug 1, 2025</td><td class="p-4 font-semibold">Monthly Report - July 2025</td><td class="p-4"><span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full">Sent</span></td><td class="p-4 hidden md:table-cell">ARR $1.1M (+5%)</td><td class="p-4 text-right"><a href="#" class="text-purple-700 hover:underline view-report-link" data-report-id="july2025">View</a></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="page-playbooks" class="p-4 sm:p-8 md:p-12">
                    <header id="playbooks-header" class="mb-8 flex justify-between items-baseline">
                         <div>
                            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">AI Playbook Guide</h1>
                            <p class="text-gray-500 mt-1 mono text-sm">Your AI copilot for strategic execution.</p>
                        </div>
                    </header>

                    <div id="playbook-library-view">
                        <div id="playbook-recommendation" class="bg-white border-2 border-purple-600 rounded-lg p-6 mb-12 shadow-lg relative">
                            <span class="absolute -top-3 left-4 text-xs font-bold uppercase mono bg-purple-600 text-white px-3 py-1 rounded-full">Recommended Focus</span>
                            <div class="flex flex-col md:flex-row md:items-center gap-6 mt-4">
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold">Unit Economics Deep Dive (LTV/CAC)</h3>
                                    <p class="text-sm text-gray-600 mt-2">Based on your recent reports noting rising customer acquisition costs and a shrinking gross margin, this playbook is the highest priority to ensure your growth is profitable and sustainable.</p>
                                </div>
                                <button id="start-guided-playbook-btn" data-playbook-id="f.a.01" class="bg-purple-700 text-white font-bold py-3 px-6 rounded-md hover:bg-purple-800 transition-all transform hover:scale-105 whitespace-nowrap">
                                    Start Guided Playbook →
                                </button>
                            </div>
                        </div>

                        <div id="playbook-library-content">
                            <h2 class="text-xl font-bold mb-6">Full Playbook Library</h2>
                            <div id="playbook-category-filters" class="flex flex-wrap gap-2 sm:gap-4 mb-12">
                                <button class="playbook-category-btn text-xs sm:text-sm font-bold px-3 py-2 rounded-full" data-category="Product">🎯 Product</button>
                                <button class="playbook-category-btn text-xs sm:text-sm font-bold px-3 py-2 rounded-full" data-category="Go-To-Market">📈 Go-To-Market</button>
                                <button class="playbook-category-btn text-xs sm:text-sm font-bold px-3 py-2 rounded-full" data-category="People & Culture">👥 People & Culture</button>
                                <button class="playbook-category-btn text-xs sm:text-sm font-bold px-3 py-2 rounded-full" data-category="Finance & Operations">⚙️ Finance & Operations</button>
                            </div>
                            <div id="ceo-playbook-list" class="space-y-8">
                                <!-- Playbook content will be injected here by JS -->
                            </div>
                        </div>
                    </div>

                    <div id="playbook-guide-view" class="hidden">
                        <div class="mb-8">
                            <button id="back-to-library-btn" class="text-sm text-gray-600 hover:text-purple-700 font-semibold">← Back to Library</button>
                            <h2 id="guide-title" class="text-2xl font-bold mt-2"></h2>
                        </div>
                        <div class="flex gap-2 mb-6">
                            <div id="guide-step-1" class="h-2 rounded-full bg-gray-300 guide-step-indicator"></div>
                            <div id="guide-step-2" class="h-2 rounded-full bg-gray-300 guide-step-indicator"></div>
                            <div id="guide-step-3" class="h-2 rounded-full bg-gray-300 guide-step-indicator"></div>
                            <div id="guide-step-4" class="h-2 rounded-full bg-gray-300 guide-step-indicator"></div>
                            <div id="guide-step-5" class="h-2 rounded-full bg-gray-300 guide-step-indicator"></div>
                            <div id="guide-step-6" class="h-2 rounded-full bg-gray-300 guide-step-indicator"></div>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <h3 id="guide-step-title" class="text-lg font-bold mb-4"></h3>
                            <div id="guide-step-content" class="prose prose-sm max-w-none"></div>
                        </div>
                        <div id="guide-navigation" class="mt-6 flex justify-between items-center">
                            <button id="guide-prev-btn" class="text-sm font-semibold text-gray-600 hover:text-gray-900 disabled:opacity-50" disabled>Previous</button>
                            <button id="guide-next-btn" class="bg-purple-700 text-white font-bold py-2 px-5 rounded-md hover:bg-purple-800 transition-colors">Next</button>
                        </div>
                    </div>
                </div>

                <div id="page-integrations" class="hidden p-4 sm:p-8 md:p-12">
                     <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Integrations</h1><p class="text-gray-500 mt-1 mono text-sm">Connect Operalta to your existing workflow.</p></header>
                     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://i.imgur.com/2s422Fk.png" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">Hubspot</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Sync your deal pipeline, customer data, and sales activities for real-time context.</p><button class="w-full bg-green-500 text-white py-2 text-sm font-bold rounded-md cursor-not-allowed">Connected</button></div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://i.imgur.com/Bf02y1S.png" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">DEEL</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Track hiring velocity, payroll expenses, and team composition automatically.</p><button class="w-full bg-green-500 text-white py-2 text-sm font-bold rounded-md cursor-not-allowed">Connected</button></div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://i.imgur.com/nJbSoop.png" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">BREX</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Monitor your cash balance, burn rate, and runway with live financial data.</p><button class="w-full bg-green-500 text-white py-2 text-sm font-bold rounded-md cursor-not-allowed">Connected</button></div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://i.imgur.com/Qk7QzSg.png" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">Salesforce</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Integrate the world's leading CRM to pull in comprehensive sales and customer data.</p><button class="connect-btn w-full bg-gray-200 text-gray-800 py-2 text-sm font-bold hover:bg-gray-300 rounded-md" data-service="Salesforce">Connect</button></div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://placehold.co/40x40/000000/FFFFFF?text=N" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">Notion</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Sync your company wiki, roadmaps, and KPIs to provide context for AI analysis.</p><button class="w-full bg-green-500 text-white py-2 text-sm font-bold rounded-md cursor-not-allowed">Connected</button></div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://placehold.co/40x40/4A154B/FFFFFF?text=S" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">Slack</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Send report summaries and get notifications directly in your team's channels.</p><button class="connect-btn w-full bg-gray-200 text-gray-800 py-2 text-sm font-bold hover:bg-gray-300 rounded-md" data-service="Slack">Connect</button></div>
                     </div>
                </div>
                
                <div id="page-settings" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Settings</h1></header>
                    <div class="bg-white p-6 sm:p-8 border border-gray-200 rounded-lg shadow-sm max-w-2xl">
                        <h2 class="text-lg font-bold mb-1">API Configuration</h2>
                        <p class="text-sm text-gray-600 mb-4">A valid Google Gemini API key is required for audio transcription and analysis.</p>
                        <div class="space-y-2">
                            <label for="api-key-input" class="text-sm font-semibold text-gray-700">Gemini API Key</label>
                            <input type="password" id="api-key-input" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" placeholder="Enter your API key">
                        </div>
                        <div class="mt-4 flex items-center justify-between">
                            <button id="save-api-key-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">Save Key</button>
                            <span id="api-key-status" class="text-sm text-green-600"></span>
                        </div>
                        <p class="text-xs text-gray-500 mt-4">You can get a key from <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-purple-700 underline">Google AI Studio</a>. Your key is stored securely in your browser's local storage.</p>
                    </div>
                </div>
            </div>

            <div id="vc-view" class="hidden">
                 <div id="page-vc-dashboard" class="p-4 sm:p-8 md:p-12">
                    <header class="mb-8">
                        <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Portfolio Dashboard</h1>
                        <p class="text-gray-500 mt-1 mono text-sm">High-level intelligence on your investments.</p>
                    </header>

                    <div class="mb-8 bg-white border border-gray-200 rounded-lg p-6">
                        <h2 class="font-bold mb-4">Portfolio Health Overview</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                            <div><p class="text-3xl font-bold text-green-600">8</p><p class="text-sm text-gray-500">On Track</p></div>
                            <div><p class="text-3xl font-bold text-yellow-500">2</p><p class="text-sm text-gray-500">Needs Attention</p></div>
                            <div><p class="text-3xl font-bold text-red-600">0</p><p class="text-sm text-gray-500">At Risk</p></div>
                        </div>
                    </div>
                    
                    <div class="mb-8 bg-white border border-gray-200 rounded-lg p-6">
                        <h2 class="font-bold mb-4">AI-Generated Cross-Portfolio Insights</h2>
                        <ul class="space-y-3 text-sm">
                            <li class="flex items-start gap-3"><span class="text-purple-600 mt-1">◈</span><span><strong>Positive Trend:</strong> 5 companies mentioned successful enterprise pilots this week, suggesting strong Q4 pipeline.</span></li>
                            <li class="flex items-start gap-3"><span class="text-yellow-600 mt-1">!</span><span><strong>Potential Risk:</strong> 3 companies in the B2C space noted rising customer acquisition costs (CAC). <a href="#" class="text-purple-700 underline">Suggest "Growth Hacking" playbook</a>.</span></li>
                            <li class="flex items-start gap-3"><span class="text-blue-600 mt-1">→</span><span><strong>Opportunity:</strong> Innovate Inc. and Synergy AI are both hiring for senior product roles. Consider an introduction between their VPs of Product to share best practices.</span></li>
                        </ul>
                    </div>

                    <div id="vc-portfolio-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Portfolio companies injected by JS -->
                    </div>
                </div>
                 <div id="page-vc-playbooks" class="hidden p-4 sm:p-8 md:p-12">
                     <header class="mb-8 flex justify-between items-baseline">
                         <div>
                            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Firm Playbooks</h1>
                            <p class="text-gray-500 mt-1 mono text-sm">Proprietary strategies for your portfolio companies.</p>
                        </div>
                        <button id="author-playbook-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">Author New Playbook</button>
                    </header>
                    <div class="mb-8">
                        <h2 class="font-bold mb-4">Atomic Ventures' Custom Playbooks</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="board-meetings"><h3 class="font-bold mb-2">Our Guide to Board Meetings</h3><p class="text-sm text-gray-600">The essential template and best practices for running an effective board meeting.</p></div>
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="term-sheet"><h3 class="font-bold mb-2">Term Sheet Negotiation 101</h3><p class="text-sm text-gray-600">Key terms and strategies for a successful fundraise.</p></div>
                        </div>
                    </div>
                     <div>
                        <h2 class="font-bold mb-4">Playbooks Popular in Your Portfolio</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="eng-hiring"><h3 class="font-bold mb-2">Scaling Engineering Teams</h3><p class="text-sm text-gray-600">From 10 to 100 engineers. The definitive guide by Revolut.</p></div>
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="seed-deck"><h3 class="font-bold mb-2">The Perfect Seed Deck</h3><p class="text-sm text-gray-600">As recommended by Y Combinator for all their early-stage founders.</p></div>
                        </div>
                    </div>
                 </div>
                 <div id="page-vc-settings" class="hidden p-4 sm:p-8 md:p-12">
                      <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Settings</h1></header>
                      <p>VC settings page placeholder.</p>
                 </div>
            </div>
        </main>
        
        <div id="recording-interface" class="recording-interface hidden flex-col items-center">
            <div id="liveRecordingTitle" class="live-recording-title hidden text-lg font-semibold">New Recording</div>
            <canvas id="liveWaveformCanvas" class="hidden"></canvas>
            <div id="liveRecordingTimerDisplay" class="live-recording-timer hidden">00:00.00</div>
            <div id="recording-status-text" class="status-text text-gray-500 mb-4">Ready to record</div>
            <div class="recording-controls">
                <button id="recordButton" class="record-button" title="Start Recording"><div class="record-button-inner"><i class="fas fa-microphone"></i></div><svg class="record-waves" viewBox="0 0 200 200"><circle class="wave wave1" cx="100" cy="100" r="40" /><circle class="wave wave2" cx="100" cy="100" r="70" /></svg></button>
            </div>
        </div>

        <!-- Generic Modal -->
        <div id="modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div id="modal-overlay" class="absolute inset-0"></div>
            <div id="modal-content" class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto relative transform scale-95 opacity-0">
                <div class="p-6">
                    <div class="flex justify-between items-center pb-4 border-b border-gray-200">
                        <h2 id="modal-title" class="text-xl font-bold">Modal Title</h2>
                        <button id="modal-close-btn" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
                    </div>
                    <div id="modal-body" class="py-6">
                        <!-- Modal content goes here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI } from "@google/genai";
        import { marked } from "marked";

        const MODEL_NAME = 'gemini-1.5-flash';

        class DictationService {
            // ... existing DictationService class code ...
        }


        document.addEventListener('DOMContentLoaded', function() {
            let dictationService = null;
            let currentView = 'ceo';
            let latestGeneratedReport = {};
            let activePlaybookCategories = [];
            let currentGuide = { playbookId: null, step: 0 };

            const ui = {
                sidebar: document.getElementById('sidebar'),
                mobileMenuBtn: document.getElementById('mobile-menu-btn'),
                ceoView: document.getElementById('ceo-view'),
                vcView: document.getElementById('vc-view'),
                ceoNav: document.getElementById('ceo-nav'),
                vcNav: document.getElementById('vc-nav'),
                ceoPlaybookList: document.getElementById('ceo-playbook-list'),
                playbookCategoryFilters: document.getElementById('playbook-category-filters'),
                vcPortfolioList: document.getElementById('vc-portfolio-list'),

                pages: {
                     dashboard: document.getElementById('page-dashboard'), recording: document.getElementById('page-recording'), reports: document.getElementById('page-reports'), playbooks: document.getElementById('page-playbooks'), integrations: document.getElementById('page-integrations'), settings: document.getElementById('page-settings'),
                     vcDashboard: document.getElementById('page-vc-dashboard'), vcPlaybooks: document.getElementById('page-vc-playbooks'), vcSettings: document.getElementById('page-vc-settings'),
                },
                navLinks: { 
                    ceo: { dashboard: document.getElementById('nav-dashboard'), reports: document.getElementById('nav-reports'), playbooks: document.getElementById('nav-playbooks'), integrations: document.getElementById('nav-integrations'), settings: document.getElementById('nav-settings') },
                    vc: { dashboard: document.getElementById('nav-vc-dashboard'), playbooks: document.getElementById('nav-vc-playbooks'), settings: document.getElementById('nav-vc-settings'), }
                },
                startRecordingBtn: document.getElementById('start-recording-btn'), newReportBtn: document.getElementById('new-report-btn'), recordButton: document.getElementById('recordButton'),
                recordingInterface: document.getElementById('recording-interface'), processingState: document.getElementById('processing-state'), processingStatus: document.getElementById('processing-status'), completedState: document.getElementById('completed-state'),
                
                extractedIntelligenceContainer: document.getElementById('extracted-intelligence'),
                strategicUpdateContainer: document.getElementById('strategic-update'),

                authorPlaybookBtn: document.getElementById('author-playbook-btn'),

                apiKeyBanner: document.getElementById('api-key-banner'), bannerSettingsLink: document.getElementById('banner-settings-link'), apiKeyInput: document.getElementById('api-key-input'),
                saveApiKeyBtn: document.getElementById('save-api-key-btn'), apiKeyStatus: document.getElementById('api-key-status'),
                viewToggle: document.getElementById('view-toggle'), userName: document.getElementById('user-name'), userCompany: document.getElementById('user-company'), userAvatar: document.getElementById('user-avatar'),
                ceoLabel: document.getElementById('ceo-label'), vcLabel: document.getElementById('vc-label'),

                modal: document.getElementById('modal'), modalOverlay: document.getElementById('modal-overlay'), modalContent: document.getElementById('modal-content'),
                modalTitle: document.getElementById('modal-title'), modalBody: document.getElementById('modal-body'), modalCloseBtn: document.getElementById('modal-close-btn'),
                
                reviewDraftReportBtn: document.getElementById('review-draft-report-btn'),
                playbookLibraryView: document.getElementById('playbook-library-view'),
                playbookGuideView: document.getElementById('playbook-guide-view'),
                startGuidedPlaybookBtn: document.getElementById('start-guided-playbook-btn'),
                backToLibraryBtn: document.getElementById('back-to-library-btn'),
                guide: {
                    title: document.getElementById('guide-title'),
                    stepTitle: document.getElementById('guide-step-title'),
                    stepContent: document.getElementById('guide-step-content'),
                    prevBtn: document.getElementById('guide-prev-btn'),
                    nextBtn: document.getElementById('guide-next-btn'),
                    progressIndicators: [
                        document.getElementById('guide-step-1'), document.getElementById('guide-step-2'), document.getElementById('guide-step-3'),
                        document.getElementById('guide-step-4'), document.getElementById('guide-step-5'), document.getElementById('guide-step-6')
                    ]
                }
            };

            const db = {
                companies: {
                    innovate: { name: 'Innovate Inc.', status: 'On Track', metrics: { arr: '€2.1M', growth: '+18%', runway: '24mo' } },
                    quantum: { name: 'QuantumLeap', status: 'Needs Attention', metrics: { arr: '€800K', growth: '-5%', runway: '9mo' } },
                    synergy: { name: 'Synergy AI', status: 'On Track', metrics: { arr: '€4.5M', growth: '+25%', runway: '16mo' } },
                    dataforge: { name: 'DataForge', status: 'On Track', metrics: { arr: '€1.5M', growth: '+12%', runway: '20mo' } },
                    nextech: { name: 'NexTech', status: 'On Track', metrics: { arr: '€3.2M', growth: '+15%', runway: '18mo' } },
                    cloudscape: { name: 'Cloudscape', status: 'Needs Attention', metrics: { arr: '€950K', growth: '+2%', runway: '11mo' } },
                    biogen: { name: 'BioGen', status: 'On Track', metrics: { arr: '€1.8M', growth: '+20%', runway: '22mo' } },
                    finwise: { name: 'FinWise', status: 'On Track', metrics: { arr: '€5.1M', growth: '+19%', runway: '15mo' } },
                    logix: { name: 'Logix', status: 'On Track', metrics: { arr: '€2.8M', growth: '+14%', runway: '19mo' } },
                    zenith: { name: 'Zenith VR', status: 'On Track', metrics: { arr: '€1.1M', growth: '+30%', runway: '14mo' } },
                },
                reports: {
                    'september2025': {
                        title: 'Weekly Report - October 2025 (Draft)',
                        content: `
                        <div id="report-content-september" contenteditable="false" class="prose prose-sm max-w-none focus:outline-none focus:ring-2 focus:ring-purple-500 focus:rounded-md p-2 -m-2">
                            <p class="text-sm text-gray-500">To be sent October 7, 2025</p>
                            <h3 class="!text-base !font-bold !mt-4 !mb-2">Key Metrics Update (W/E Oct 5)</h3>
                            <p>A solid week focused on execution. We're holding steady on top-line metrics while addressing the underlying efficiency issues identified last month. Pipeline velocity has increased slightly.</p>
                            
                            <h3 class="!text-base !font-bold !mt-6 !mb-2">Sales Update</h3>
                            <ul>
                                <li><strong>Globex Corp ($120k):</strong> We've established a direct line of communication with their legal team. They've confirmed receipt of our revised draft and have given a timeline of 5 business days for feedback. This is a positive step forward.</li>
                                <li><strong>New Pipeline:</strong> A promising inbound lead from Acme Dynamics (a Fortune 1000 company) came through this week after a mention in a trade publication. First call is scheduled for Friday.</li>
                            </ul>

                            <h3 class="!text-base !font-bold !mt-6 !mb-2">Team & Product Update</h3>
                            <ul>
                                <li><strong>Team:</strong> Our three new Q3 hires are fully ramped and contributing. Maria (our new AE) has already sourced two qualified opportunities. Team morale is high.</li>
                                <li><strong>Product:</strong> Adoption of the v2 dashboard is now at 75% of our active user base. We're getting consistent feedback about the "scenario planning" feature being a key differentiator.</li>
                            </ul>

                            <h3 class="!text-base !font-bold !mt-6 !mb-2">Ask</h3>
                            <ul>
                                <li>To de-risk the Globex Corp legal review and streamline future enterprise contracts, we're looking for an introduction to a fractional legal counsel specializing in B2B SaaS enterprise agreements. Any recommendations would be greatly appreciated.</li>
                            </ul>
                        </div>`
                    },
                    'august2025': {
                        title: 'Monthly Report - August 2025',
                        content: `
                        <p class="text-sm text-gray-500">Sent on September 1, 2025</p>
                        <h3 class="!text-base !font-bold !mt-4 !mb-2">Executive Summary</h3>
                        <p>August was a strong month, with ARR growing by 9% to $1.2M, driven by the successful onboarding of two major enterprise clients. We also launched the new analytics dashboard, which has received positive initial feedback.</p>
                        <h3 class="!text-base !font-bold !mt-6 !mb-2">Key Metrics</h3>
                         <table class="w-full text-left">
                            <thead class="border-b"><tr><th class="py-1">Metric</th><th class="py-1">This Month</th><th class="py-1">Last Month</th><th class="py-1">Change</th></tr></thead>
                            <tbody>
                                <tr class="border-b"><td class="py-1">ARR</td><td class="py-1">$1.2M</td><td class="py-1">$1.1M</td><td class="py-1 text-green-600">+9%</td></tr>
                                <tr class="border-b"><td class="py-1">MRR</td><td class="py-1">$100k</td><td class="py-1">$91.7k</td><td class="py-1 text-green-600">+9%</td></tr>
                                <tr><td class="py-1">CAC</td><td class="py-1">$5.2k</td><td class="py-1">$5.0k</td><td class="py-1 text-yellow-600">+4%</td></tr>
                            </tbody>
                        </table>
                        <h3 class="!text-base !font-bold !mt-6 !mb-2">Wins</h3>
                        <ul>
                            <li>Onboarded new enterprise clients: Innovate LLC and Globex Corp, adding $15k in new MRR.</li>
                            <li>Successful launch of the v2 analytics dashboard.</li>
                        </ul>`
                    },
                    'july2025': {
                        title: 'Monthly Report - July 2025',
                        content: `
                        <p class="text-sm text-gray-500">Sent on August 1, 2025</p>
                        <h3 class="!text-base !font-bold !mt-4 !mb-2">Executive Summary</h3>
                        <p>July was a solid month focused on product development and stabilizing our sales pipeline. ARR grew a modest 5% to $1.1M while we kept CAC flat. The team made significant progress on the upcoming v2 analytics dashboard.</p>
                        <h3 class="!text-base !font-bold !mt-6 !mb-2">Key Metrics</h3>
                         <table class="w-full text-left">
                            <thead class="border-b"><tr><th class="py-1">Metric</th><th class="py-1">This Month</th><th class="py-1">Last Month</th><th class="py-1">Change</th></tr></thead>
                            <tbody>
                                <tr class="border-b"><td class="py-1">ARR</td><td class="py-1">$1.1M</td><td class="py-1">$1.05M</td><td class="py-1 text-green-600">+5%</td></tr>
                                <tr class="border-b"><td class="py-1">MRR</td><td class="py-1">$91.7k</td><td class="py-1">$87.5k</td><td class="py-1 text-green-600">+5%</td></tr>
                                <tr><td class="py-1">CAC</td><td class="py-1">$5.0k</td><td class="py-1">$5.0k</td><td class="py-1">0%</td></tr>
                            </tbody>
                        </table>
                        <h3 class="!text-base !font-bold !mt-6 !mb-2">Key Activities</h3>
                        <ul>
                            <li>Engineering team is 90% complete with the v2 dashboard.</li>
                            <li>Closed 5 mid-market deals.</li>
                        </ul>`
                    },
                    'q3-2025': {
                        title: 'Q3 2025 Quarterly Report',
                        content: `
                        <p class="text-sm text-gray-500">Sent on October 1, 2025</p>
                        <h3 class="!text-base !font-bold !mt-4 !mb-2">Q3 Executive Summary</h3>
                        <p>Q3 was a quarter of accelerated growth, with ARR increasing by 19% from $1.05M to $1.25M. This was driven by a successful push into the enterprise segment in August. However, this growth was accompanied by a concerning 16% rise in Customer Acquisition Cost over the quarter, from $5.0k to $5.8k, which will be our primary focus for Q4.</p>
                        <h3 class="!text-base !font-bold !mt-6 !mb-2">Quarterly Metrics</h3>
                         <table class="w-full text-left">
                            <thead class="border-b"><tr><th class="py-1">Metric</th><th class="py-1">End of Q3</th><th class="py-1">End of Q2</th><th class="py-1">QoQ Change</th></tr></thead>
                            <tbody>
                                <tr class="border-b"><td class="py-1">ARR</td><td class="py-1">$1.25M</td><td class="py-1">$1.05M</td><td class="py-1 text-green-600">+19%</td></tr>
                                <tr><td class="py-1">Net New ARR</td><td class="py-1">$200k</td><td class="py-1">$150k</td><td class="py-1 text-green-600">+33%</td></tr>
                                <tr><td class="py-1">CAC</td><td class="py-1">$5.8k</td><td class="py-1">$5.0k</td><td class="py-1 text-red-600">+16%</td></tr>
                            </tbody>
                        </table>
                        <h3 class="!text-base !font-bold !mt-6 !mb-2">Key Achievements in Q3</h3>
                        <ul>
                            <li>Landed first two enterprise clients, validating our upmarket strategy.</li>
                            <li>Shipped major product update (v2 Dashboard), which has increased weekly active users by 15%.</li>
                            <li>Expanded team with 3 key hires in engineering and sales.</li>
                        </ul>
                        <h3 class="!text-base !font-bold !mt-6 !mb-2">Focus for Q4</h3>
                        <ul>
                            <li><strong>Unit Economics:</strong> Launch a cross-functional squad to optimize marketing spend and reduce CAC by at least 10%.</li>
                            <li><strong>Sales:</strong> Unblock stalled enterprise deals, specifically Globex Corp, to secure an additional $120k in ARR.</li>
                            <li><strong>Strategy:</strong> Begin compiling the data room and narrative for our Series A fundraising process, targeting a Q1 2026 kickoff.</li>
                        </ul>`
                    },
                },
                playbooks: {
                    // Pre-Seed Stage
                    'p.ps.01': {
                        stage: 'Pre-Seed',
                        category: 'Product',
                        title: 'Customer Problem Validation (The Mom Test)',
                        diagnostic: "You describe your idea and people say, \"That's nice,\" but show no real excitement. You can't clearly articulate how your target users solve the problem today. You find yourself talking 80% of the time in user interviews.",
                        actions: "Conduct 20-30 problem-discovery interviews without mentioning your idea. Ask about their workflow and pains related to the problem space. Dig into past behaviors (\"Tell me about the last time you...\"), not future hypotheticals.",
                        validation: "Have we heard multiple, independent users describe a specific, urgent, and expensive problem without us prompting them?",
                        implementation: "Use LinkedIn to find people with your target job title. Send a simple, non-salesy message asking for a 15-min chat to learn about their expertise in a specific area. Log every interview quote in a central document to find patterns.",
                        result: "You will be able to articulate the problem with extreme clarity, using your customers' own language. You will have a validated list of \"hair on fire\" pain points to build your solution around.",
                        impact: "Primary: Number of validated problem interviews conducted (Target: 20+). Secondary: A \"Pain Score\" (1-5 scale) for each interview. Your average score should be >3.5 before building."
                    },
                    'g.ps.03': {
                        stage: 'Pre-Seed',
                        category: 'Go-To-Market',
                        title: "Do Things That Don't Scale (YC/Paul Graham)",
                        diagnostic: "You have a product but zero users. You're waiting for users to discover you. You're trying to set up automated marketing funnels before you have a single paying customer.",
                        actions: "Manually recruit your first 10-100 users. Go to conferences, personally email people in your target market, do whatever it takes. Give them an incredible, white-glove onboarding experience. Personally walk them through the product.",
                        validation: "Are we willing to do unscalable, manual, and even tedious work to create a small group of fanatical early customers?",
                        implementation: "The goal is not growth; it's learning. Every manual interaction is a chance to get deep feedback. Create a \"VIP\" Slack channel for your first 20 users and give them direct access to the founders.",
                        result: "You will build a core base of users who love you and will become your first evangelists. The deep qualitative feedback you get will be invaluable for finding Product-Market Fit.",
                        impact: "Primary: Number of fanatical users acquired (Target: 10-20). Secondary: A book of quotes and insights to guide your first 6 months of product development."
                    },
                    'pc.ps.01': {
                        stage: 'Pre-Seed',
                        category: 'People & Culture',
                        title: 'Co-Founder Alignment',
                        diagnostic: "You and your co-founder haven't had explicit conversations about equity, roles, or long-term personal goals. There are unstated assumptions that could lead to conflict later.",
                        actions: "Sit down and have a structured conversation covering: 1. Personal goals (what does success look like for you in 5 years?). 2. Roles & Responsibilities (who is the final decider on Product, Sales, etc.?). 3. Equity split and vesting schedule (a standard 4-year vest with a 1-year cliff is non-negotiable).",
                        validation: "Are we willing to have these potentially awkward conversations now to build a foundation of trust and prevent a catastrophic breakup later?",
                        implementation: "Write the answers down. This isn't about creating a legal contract (though you should get that done too), but about ensuring you are both on the same page. Use a template like the Founder Dating checklist.",
                        result: "A strong, aligned founding team with clear expectations and a shared vision. This is the bedrock of any successful company.",
                        impact: "Primary: A signed legal document outlining equity and vesting. Secondary: A written \"Co-Founder Agreement\" document outlining roles and decision-making processes."
                    },
                    'f.ps.01': {
                        stage: 'Pre-Seed',
                        category: 'Finance & Operations',
                        title: 'Burn Rate & Runway Calculation',
                        diagnostic: "You're not sure how much money the company is spending each month or when you will run out of cash. You're making spending decisions based on gut feel.",
                        actions: "Create a simple spreadsheet. List all your fixed monthly costs (salaries, rent, software). Add your variable costs (marketing spend, contractors). The total is your Gross Burn. Subtract any monthly revenue to get your Net Burn. Divide your cash in the bank by your Net Burn to get your Runway in months.",
                        validation: "Do I know, at this exact moment, how many months of runway we have left in the bank?",
                        implementation: "This is your most important financial document. Update it on the 1st of every month. Use a simple tool like Google Sheets.",
                        result: "You will have a crystal-clear understanding of your financial situation, enabling you to make informed decisions about hiring, spending, and when you need to start fundraising.",
                        impact: "Primary: A consistently updated and accurate runway calculation. Secondary: The ability to forecast how hiring or spending decisions will impact your runway."
                    },
                    // Seed Stage
                    'p.s.01': {
                        stage: 'Seed',
                        category: 'Product',
                        title: 'The Product-Market Fit Engine (Rahul Vohra/Superhuman)',
                        diagnostic: "High initial signups, but a massive drop-off after Day 7. User feedback is lukewarm (\"it's nice\") not urgent (\"I need this\"). Free-to-paid conversion is abysmal.",
                        actions: "Systematically survey your users with the question: \"How would you feel if you could no longer use our product?\" (A: Very disappointed, B: Somewhat, C: Not). Isolate and interview the \"Very disappointed\" cohort to understand your core value.",
                        validation: "Do we have a data-informed hypothesis about who our high-expectation customer is and what single benefit they value most? Are we willing to ignore other users to serve them?",
                        implementation: "Use Tally or SurveyMonkey. Trigger the survey in-app or via email after a user has been active for ~2 weeks. Segment results by user role, company size, or persona to find your PMF niche.",
                        result: "A radically simplified and focused product roadmap. Your marketing message becomes sharp and clear, centered on the single benefit your best users identified.",
                        impact: "Primary: % of users answering \"Very disappointed\" (Target: >40%). Secondary: Improvement in Week-4 cohort retention."
                    },
                     'g.s.01': {
                        stage: 'Seed',
                        category: 'Go-To-Market',
                        title: 'Founder-Led Sales to First Repeatable Play',
                        diagnostic: "You are the only person who can sell. Every deal feels like a custom project. You have no standard sales deck or demo script. Revenue is lumpy and unpredictable.",
                        actions: "Analyze your last 10 closed deals to define a narrow Ideal Customer Profile (ICP). Record your next 5 sales calls and document your process meticulously. Create a \"Sales Playbook v1\" in Notion/Coda with scripts, objection handling, and email templates.",
                        validation: "Have we won at least 3-5 deals in a specific niche where the buying journey was nearly identical? Do we believe we can find 50 more of these customers?",
                        implementation: "Set up a simple 4-stage CRM pipeline (e.g., in HubSpot or Close). Hire your first salesperson to be an \"explorer\" who helps refine the playbook, not just a robot to execute it.",
                        result: "A playbook that allows a new salesperson to replicate your success with some consistency. A basic understanding of your sales cycle length and conversion rates.",
                        impact: "Primary: Time for new sales rep to close their first deal (Target: <60 days). Secondary: A stable demo-to-close conversion rate (>20%)."
                    },
                    // Series A
                    'p.a.01': {
                        stage: 'Series A',
                        category: 'Product',
                        title: 'Outcome-Oriented Roadmapping',
                        diagnostic: "Your team is constantly busy shipping features, but your core business metrics aren't improving. The roadmap is a list of outputs (e.g., \"Build Feature X\"), not outcomes (e.g., \"Increase activation rate by 15%\").",
                        actions: "Shift your entire product planning process away from features. Structure your roadmap around the business or customer outcomes you want to achieve each quarter. For example, a quarterly theme could be \"Improve the First-Time User Experience.\"",
                        validation: "For every major item on our roadmap, can we clearly articulate the business metric it is intended to move?",
                        implementation: "Use a tool like Productboard or Jira and structure your epics around outcomes. The product team's job is not just to ship the feature, but to own the metric and continue iterating until the outcome is achieved.",
                        result: "A product team that is deeply connected to the business. You will stop shipping features that nobody uses and focus your limited engineering resources on the things that create the most value.",
                        impact: "Primary: A higher percentage of product initiatives that successfully move a target business metric. Secondary: Improved eNPS scores from the engineering team, who now understand the \"why\" behind their work."
                    },
                    'f.a.01': {
                        stage: 'Series A',
                        category: 'Finance & Operations',
                        title: 'Unit Economics Deep Dive (LTV/CAC)',
                        diagnostic: "Revenue is growing, but so are our losses. You're not sure if your customers are profitable. Gross margins are shrinking.",
                        actions: "Calculate your LTV (Lifetime Value) and CAC (Customer Acquisition Cost) for each major customer segment and marketing channel. Aim for an LTV/CAC ratio of at least 3:1.",
                        validation: "Do we know, with confidence, which of our customer segments are profitable and which are not?",
                        implementation: "This requires data from your CRM (like HubSpot), your payment processor (like Stripe), and your marketing platforms (like Google Ads). Build a simple dashboard in a BI tool or even Google Sheets to track this monthly.",
                        result: "A clear understanding of the profitability of your growth engine. This enables you to make data-driven decisions about where to invest your sales and marketing resources.",
                        impact: "Primary: LTV/CAC ratio > 3. Secondary: CAC Payback Period < 18 months."
                    },
                }
            };

            function showPage(pageName) {
                const pageMap = {
                    'dashboard': ui.pages.dashboard, 'recording': ui.pages.recording, 'reports': ui.pages.reports, 'playbooks': ui.pages.playbooks, 'integrations': ui.pages.integrations, 'settings': ui.pages.settings,
                    'vc-dashboard': ui.pages.vcDashboard, 'vc-playbooks': ui.pages.vcPlaybooks, 'vc-settings': ui.pages.vcSettings,
                };
                Object.values(ui.pages).forEach(page => page?.classList.add('hidden'));
                pageMap[pageName]?.classList.remove('hidden');

                const navMap = currentView === 'ceo' ? ui.navLinks.ceo : ui.navLinks.vc;
                const navKey = pageName.replace('vc-', '');
                Object.values(navMap).forEach(link => link?.classList.remove('active'));
                navMap[navKey]?.classList.add('active');
                
                if (ui.sidebar.classList.contains('translate-x-0')) {
                    ui.sidebar.classList.remove('translate-x-0');
                    ui.sidebar.classList.add('-translate-x-full');
                }
            }
            
            function initializeDictationService(apiKey) {
                // ... existing dictation service init code ...
            }

            function renderCompletedState(data) {
                // ... existing completed state rendering code ...
            }
            
            Date.prototype.getWeek = function() { var d = new Date(Date.UTC(this.getFullYear(), this.getMonth(), this.getDate())); var dayNum = d.getUTCDay() || 7; d.setUTCDate(d.getUTCDate() + 4 - dayNum); var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1)); return Math.ceil((((d - yearStart) / 86400000) + 1)/7) };
            
            function updateRecordButtonState() {
                // ... existing button state code ...
            }

            function saveApiKey() {
                // ... existing save API key code ...
            }
            
            function switchView() {
                // ... existing view switching code ...
            }
            
            // Modal Logic
            function showModal(title, body) {
                ui.modalTitle.innerHTML = title;
                ui.modalBody.innerHTML = '';
                ui.modalBody.appendChild(body);
                ui.modal.classList.remove('hidden');
                setTimeout(() => { ui.modalOverlay.classList.remove('opacity-0'); ui.modalContent.classList.remove('scale-95', 'opacity-0'); }, 10);
            }

            function hideModal() {
                ui.modalOverlay.classList.add('opacity-0');
                ui.modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => ui.modal.classList.add('hidden'), 300);
            }
            
            function showShareModal() {
                // ... existing share modal code ...
            }

            function showFullReportModal(reportId) {
                const report = db.reports[reportId];
                if (!report) return;

                const content = document.createElement('div');
                content.innerHTML = `<div class="prose prose-sm max-w-none">${report.content}</div>`;
                
                if (reportId === 'september2025') {
                    const buttonContainer = document.createElement('div');
                    buttonContainer.className = 'mt-6 pt-4 border-t border-gray-200';
                    buttonContainer.innerHTML = `<button id="edit-report-btn" class="w-full bg-purple-100 text-purple-700 font-bold py-2 px-4 rounded-md hover:bg-purple-200 transition-colors">Edit Report</button>`;
                    content.appendChild(buttonContainer);

                    buttonContainer.querySelector('#edit-report-btn').addEventListener('click', (e) => {
                        e.preventDefault();
                        const btn = e.currentTarget;
                        const reportContent = content.querySelector('#report-content-september');

                        if (reportContent.isContentEditable) {
                            reportContent.contentEditable = false;
                            btn.textContent = 'Edit Report';
                            btn.classList.remove('bg-green-100', 'text-green-700');
                            btn.classList.add('bg-purple-100', 'text-purple-700');
                            reportContent.style.outline = 'none';
                        } else {
                            reportContent.contentEditable = true;
                            btn.textContent = 'Save Changes';
                            btn.classList.remove('bg-purple-100', 'text-purple-700');
                            btn.classList.add('bg-green-100', 'text-green-700');
                            reportContent.style.outline = '2px solid var(--accent)';
                            reportContent.focus();
                        }
                    });
                }

                showModal(report.title, content);
            }

            function showCompanyDetailModal(companyId) {
                // ... existing company detail modal code ...
            }

            function showPlaybookModal(playbookId) {
                const playbook = db.playbooks[playbookId];
                if (!playbook) return;

                const content = document.createElement('div');
                const playbookSteps = [
                    { title: 'Diagnostic (Symptoms)', content: playbook.diagnostic },
                    { title: 'Recommended Actions', content: playbook.actions },
                    { title: 'Founder/CEO Validation', content: playbook.validation },
                    { title: 'In-Context Implementation', content: playbook.implementation },
                    { title: 'Expected Result', content: playbook.result },
                    { title: 'Measured Impact / KPIs', content: playbook.impact },
                ];
                
                let stepsHtml = playbookSteps.map(step => {
                    if (!step.content) return '';
                    return `
                        <div class="playbook-step">
                            <h3>${step.title}</h3>
                            ${marked.parse(step.content)}
                        </div>
                    `;
                }).join('');

                content.innerHTML = `<div class="prose prose-sm max-w-none">${stepsHtml}</div>
                <div class="mt-8 pt-6 border-t border-gray-200 text-center">
                    <button class="modal-start-guided-btn bg-purple-700 text-white font-bold py-3 px-6 rounded-md hover:bg-purple-800 transition-all transform hover:scale-105" data-playbook-id="${playbookId}">
                        Start Guided Playbook →
                    </button>
                </div>`;

                content.querySelector('.modal-start-guided-btn').addEventListener('click', (e) => {
                    hideModal();
                    // Timeout to allow modal to close before switching views
                    setTimeout(() => showGuidedPlaybook(e.currentTarget.dataset.playbookId), 300);
                });
                
                const titleHtml = `${playbook.title} <span class="ml-2 text-xs font-semibold uppercase mono px-2 py-1 bg-gray-200 text-gray-600 rounded-full">${playbook.stage}</span>`;

                showModal(titleHtml, content);
            }

            function showReportDraftModal() {
                showFullReportModal('september2025');
            }

            function showConnectModal(serviceName) {
                const content = document.createElement('div');
                content.innerHTML = `
                    <p class="text-sm text-center">You will be redirected to ${serviceName} to authorize Operalta.</p>
                    <div class="mt-6 flex justify-center">
                        <button class="bg-purple-700 text-white font-bold py-2 px-6 rounded-md hover:bg-purple-800">Continue</button>
                    </div>
                `;
                showModal(`Connect to ${serviceName}`, content);
            }
            
            function showAuthorPlaybookModal() {
                 const content = document.createElement('div');
                content.innerHTML = `
                    <div class="space-y-4">
                        <div><label class="text-sm font-bold text-gray-700">Playbook Title</label><input type="text" placeholder="e.g., Our Guide to Board Meetings" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></div>
                        <div><label class="text-sm font-bold text-gray-700">Content (Markdown supported)</label><textarea rows="8" placeholder="### Key Principles..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea></div>
                    </div>
                    <div class="flex justify-between items-center mt-6">
                        <button id="share-playbook-btn" class="bg-gray-200 text-gray-800 px-4 py-2 text-sm font-bold hover:bg-gray-300 rounded-md">Share with Portfolio</button>
                        <button id="save-playbook-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 rounded-md">Save Playbook</button>
                    </div>`;
                showModal('Author New Playbook', content);
                 content.querySelector('#save-playbook-btn').addEventListener('click', (e) => { const btn = e.currentTarget; btn.textContent = 'Saved!'; btn.classList.replace('bg-purple-700', 'bg-green-500'); setTimeout(hideModal, 1500); });
                 content.querySelector('#share-playbook-btn').addEventListener('click', () => alert('Playbook shared with portfolio!'));
            }
            
            function populateCeoPlaybooks() {
                const activeCategories = Array.from(ui.playbookCategoryFilters.querySelectorAll('.playbook-category-btn.active')).map(btn => btn.dataset.category);
                
                const categories = { 'Product': [], 'Go-To-Market': [], 'People & Culture': [], 'Finance & Operations': [] };
                
                let visiblePlaybooks = Object.entries(db.playbooks).filter(([id, playbook]) => {
                    return playbook.category && (activeCategories.length === 0 || activeCategories.includes(playbook.category));
                });

                if (visiblePlaybooks.length === 0 && activeCategories.length > 0) {
                     ui.ceoPlaybookList.innerHTML = `<div class="text-center text-gray-500 col-span-full py-12">No playbooks found in the selected categories.</div>`;
                    return;
                } else if (visiblePlaybooks.length === 0) {
                    // This case should not happen if some playbooks exist, but as a fallback
                     ui.ceoPlaybookList.innerHTML = `<div class="text-center text-gray-500 col-span-full py-12">Select a category to see relevant playbooks.</div>`;
                     return;
                }


                visiblePlaybooks.forEach(([id, p]) => {
                    const html = `
                        <div class="bg-white border border-gray-200 p-4 rounded-lg flex justify-between items-center group transition-shadow hover:shadow-md">
                            <div>
                                <p class="font-semibold text-gray-800">${p.title}</p>
                                <p class="text-sm text-gray-500 mono uppercase text-xs font-bold tracking-wider">${p.stage}</p>
                            </div>
                            <button class="playbook-view-btn text-xs bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-semibold hover:bg-purple-100 hover:text-purple-700 transition-colors" data-playbook-id="${id}">View</button>
                        </div>`;
                    if(categories[p.category]) categories[p.category].push(html);
                });
                
                let fullHtml = '';
                for (const [categoryName, items] of Object.entries(categories)) {
                    if (items.length) {
                        const iconMap = { 'Product': '🎯', 'Go-To-Market': '📈', 'People & Culture': '👥', 'Finance & Operations': '⚙️' };
                        fullHtml += `<div class="mb-12"><h3 class="text-lg font-bold mb-4 pb-2 border-b-2 border-gray-200 flex items-center gap-3"><span class="text-xl">${iconMap[categoryName]}</span><span>${categoryName}</span></h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">${items.join('')}</div></div>`;
                    }
                }
                
                ui.ceoPlaybookList.innerHTML = fullHtml;

                document.querySelectorAll('#ceo-playbook-list .playbook-view-btn').forEach(link => {
                    link.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); showPlaybookModal(e.currentTarget.dataset.playbookId); });
                });
            }

            function populateVcPortfolio() {
                // ... existing portfolio population code ...
            }
            
            function showGuidedPlaybook(playbookId) {
                showPage('playbooks');
                currentGuide.playbookId = playbookId;
                currentGuide.step = 0;
                const playbook = db.playbooks[playbookId];
                if (!playbook) return;

                ui.playbookLibraryView.classList.add('hidden');
                ui.playbookGuideView.classList.remove('hidden');
                ui.guide.title.textContent = playbook.title;
                
                renderGuideStep();
            }

            function hideGuidedPlaybook() {
                ui.playbookGuideView.classList.add('hidden');
                ui.playbookLibraryView.classList.remove('hidden');
                currentGuide.playbookId = null;
                currentGuide.step = 0;
            }

            function renderGuideStep() {
                const playbook = db.playbooks[currentGuide.playbookId];
                const stepIndex = currentGuide.step;
                
                const guideSteps = [
                    { title: 'Step 1: Understand the "Why"', content: playbook.diagnostic, type: 'ai', prompt: "First, let's confirm the diagnosis. Does this sound like what you're experiencing?" },
                    { title: 'Step 2: Review the High-Level Plan', content: playbook.actions, type: 'ai', prompt: "Here are the recommended actions. At a high level, does this approach make sense for your team?" },
                    { title: 'Step 3: Gut Check & Commit', content: playbook.validation, type: 'ai', prompt: "This is the commitment check. Are you and your team prepared to follow through on this?" },
                    { title: 'Step 4: Create a Tactical Plan', content: playbook.implementation, type: 'user', prompt: "Now, let's make this tactical. How will you specifically implement these steps at Acme Inc.?" },
                    { title: 'Step 5: Define the Desired Outcome', content: playbook.result, type: 'ai', prompt: "If we execute this correctly, this is the expected result. Does this outcome align with your strategic goals for this quarter?" },
                    { title: 'Step 6: Set Success Metrics', content: playbook.impact, type: 'user', prompt: "Finally, let's define success. Are these the right KPIs to track? Should we add or modify any?" },
                ];

                const currentStepData = guideSteps[stepIndex];
                
                ui.guide.stepTitle.textContent = currentStepData.title;
                
                let contentHtml = `
                    <div class="flex items-start gap-3 mb-4">
                        <div class="w-8 h-8 rounded-full bg-purple-100 text-purple-700 flex items-center justify-center flex-shrink-0 font-bold text-sm">AI</div>
                        <div class="p-4 rounded-lg ai-bubble flex-1">
                            <p class="font-semibold mb-2">${currentStepData.prompt}</p>
                            <div class="text-gray-700">${marked.parse(currentStepData.content)}</div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 mt-6">
                        <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-700 flex items-center justify-center flex-shrink-0 font-bold text-sm">YOU</div>
                        <div class="p-4 rounded-lg user-bubble flex-1">
                            <div class="input-wrapper">
                                <textarea class="w-full h-24 p-2 text-sm bg-transparent border border-indigo-200 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="Type or speak your thoughts..."></textarea>
                                <i class="fas fa-microphone mic-icon"></i>
                            </div>
                        </div>
                    </div>`;

                ui.guide.stepContent.innerHTML = contentHtml;

                // Update progress bar
                ui.guide.progressIndicators.forEach((indicator, i) => {
                    indicator.classList.remove('active', 'completed');
                    if (i < stepIndex) {
                        indicator.classList.add('completed');
                    } else if (i === stepIndex) {
                        indicator.classList.add('active');
                    }
                });

                // Update navigation buttons
                ui.guide.prevBtn.disabled = stepIndex === 0;
                if (stepIndex === guideSteps.length - 1) {
                    ui.guide.nextBtn.textContent = 'Complete Playbook';
                    ui.guide.nextBtn.classList.replace('bg-purple-700', 'bg-green-600');
                    ui.guide.nextBtn.classList.replace('hover:bg-purple-800', 'hover:bg-green-700');
                } else {
                    ui.guide.nextBtn.textContent = 'Next';
                    ui.guide.nextBtn.classList.replace('bg-green-600', 'bg-purple-700');
                    ui.guide.nextBtn.classList.replace('hover:bg-green-700', 'hover:bg-purple-800');
                }
            }


            // Event Listeners Setup
            Object.entries(ui.navLinks.ceo).forEach(([name, link]) => link?.addEventListener('click', (e) => { e.preventDefault(); showPage(name); }));
            Object.entries(ui.navLinks.vc).forEach(([name, link]) => link?.addEventListener('click', (e) => { e.preventDefault(); showPage(`vc-${name}`); }));
            
            ui.bannerSettingsLink.addEventListener('click', (e) => { e.preventDefault(); showPage('settings'); });
            ui.mobileMenuBtn.addEventListener('click', () => { ui.sidebar.classList.toggle('-translate-x-full'); });
            if (ui.startRecordingBtn) ui.startRecordingBtn.addEventListener('click', () => { 
                if (!dictationService || !dictationService.isReady()) {
                     showPage('settings');
                } else {
                    dictationService.toggleRecording()
                }
            });
            if(ui.newReportBtn) ui.newReportBtn.addEventListener('click', () => showPage('dashboard'));
            ui.saveApiKeyBtn.addEventListener('click', saveApiKey);
            //ui.viewToggle.addEventListener('change', switchView);
            
            document.addEventListener('click', function(e) {
                if (e.target && e.target.id == 'finalize-report-btn-2') {
                    showShareModal();
                }
                if (e.target.classList.contains('connect-btn')) {
                    showConnectModal(e.target.dataset.service);
                }
                 if (e.target.classList.contains('nav-link')) {
                    e.preventDefault();
                    showPage(e.target.dataset.page);
                }
            });
            
            ui.reviewDraftReportBtn.addEventListener('click', showReportDraftModal);
            if(ui.authorPlaybookBtn) ui.authorPlaybookBtn.addEventListener('click', showAuthorPlaybookModal);
            
            ui.startGuidedPlaybookBtn.addEventListener('click', (e) => showGuidedPlaybook(e.currentTarget.dataset.playbookId));
            ui.backToLibraryBtn.addEventListener('click', hideGuidedPlaybook);

            ui.guide.nextBtn.addEventListener('click', () => {
                if (currentGuide.step < 5) {
                    currentGuide.step++;
                    renderGuideStep();
                } else {
                    alert("Playbook completed! You're ready to execute.");
                    hideGuidedPlaybook();
                }
            });
            ui.guide.prevBtn.addEventListener('click', () => {
                if (currentGuide.step > 0) {
                    currentGuide.step--;
                    renderGuideStep();
                }
            });


            document.querySelectorAll('.view-report-link').forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); showFullReportModal(e.target.dataset.reportId); }));
            document.querySelectorAll('#page-vc-playbooks .playbook-link').forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); showPlaybookModal(e.currentTarget.dataset.playbookId); }));
            
            ui.modalCloseBtn.addEventListener('click', hideModal);
            ui.modalOverlay.addEventListener('click', hideModal);
            
            ui.playbookCategoryFilters.addEventListener('click', (e) => {
                const targetButton = e.target.closest('.playbook-category-btn');
                if (targetButton) {
                    targetButton.classList.toggle('active');
                    populateCeoPlaybooks();
                }
            });

            // Initial Load
            const savedApiKey = localStorage.getItem('geminiApiKey');
            if (savedApiKey) ui.apiKeyInput.value = savedApiKey;
            // The DictationService class is not fully included here to save space, but it would be initialized as before.
            // initializeDictationService(savedApiKey); 
            populateCeoPlaybooks();
            populateVcPortfolio();
            showPage('dashboard'); // Default to dashboard view
        });
    </script>
</body>
</html>


